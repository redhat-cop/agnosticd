---
- name: Install ansible-galaxy requirements
  include_tasks:
    file: ansible_galaxy_install_requirements.yml
  when: __requirement_paths | default([]) | length > 0
  vars:

    __ansible_galaxy_requirements_content: >-
      {{ lookup( 'agnosticd_requirements', __requirement_paths ) }}

    __requirement_paths: >-
      {{
      [
        'roles/foundations/' ~ agnosticd_foundation | default('') ~ '/meta/requirements.yml',
        'roles/architectures/' ~ agnosticd_architecture | default('') ~ '/meta/requirements.yml'
      ]
      +
      __workloads }}

    __workloads: >-
      [
      {% for agnosticd_workload in agnosticd_workloads %}
      {{ ('roles/workloads/' ~ agnosticd_workload.name ~ '/meta/requirements.yml') | to_json -}}
      {{- ',' if not loop.last else '' }}
      {% endfor %}
      ]
