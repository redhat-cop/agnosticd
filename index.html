<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Agnosticd documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Agnosticd documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_agnosticd_configs">1. AgnosticD &amp; Configs</a>
<ul class="sectlevel2">
<li><a href="#_what_are_configs">1.1. What are <em>configs</em>?</a></li>
<li><a href="#_how_you_deploy_configs">1.2. How <strong>you</strong> Deploy <em>configs</em></a></li>
<li><a href="#_how_agnosticd_deploys_configs">1.3. How <strong>AgnosticD</strong> Deploys <em>configs</em></a></li>
</ul>
</li>
<li><a href="#_overview_of_a_typical_config">2. Overview of a Typical <em>Config</em></a>
<ul class="sectlevel2">
<li><a href="#_sample_vars_yml">2.1. <code>sample_vars.yml</code></a></li>
<li><a href="#_default_vars_yml">2.2. <code>default_vars.yml</code></a></li>
<li><a href="#_secret_yml">2.3. <code>secret.yml</code></a></li>
</ul>
</li>
<li><a href="#_agnosticd_flow">3. AgnosticD Flow</a>
<ul class="sectlevel2">
<li><a href="#_stage_0_pre_infra_yml">3.1. Stage 0 <code>pre_infra.yml</code></a></li>
<li><a href="#_stage_1_cloud_provider_deploy">3.2. Stage 1 Cloud Provider Deploy</a></li>
<li><a href="#_stage_2_post_infra_yml">3.3. Stage 2 <code>post_infra.yml</code></a></li>
<li><a href="#_stage_3_pre_software_yml">3.4. Stage 3 <code>pre_software.yml</code></a></li>
<li><a href="#_stage_4_software_yml">3.5. Stage 4 <code>software.yml</code></a></li>
<li><a href="#_stage_5_post_software_yml">3.6. Stage 5 <code>post_software.yml</code></a></li>
</ul>
</li>
<li><a href="#_preparing_your_workstation">4. Preparing your workstation</a>
<ul class="sectlevel2">
<li><a href="#_red_hat_subscriptions">4.1. Red Hat subscriptions</a></li>
<li><a href="#_agnosticd_from_a_container">4.2. AgnosticD from a Container</a></li>
<li><a href="#_workstation_setup_for_openstack">4.3. Workstation setup for OpenStack</a></li>
<li><a href="#_workstation_setup_for_aws">4.4. Workstation setup for AWS</a></li>
<li><a href="#_workstation_setup_for_azure">4.5. Workstation setup for Azure</a></li>
</ul>
</li>
<li><a href="#_config_writing_tutorials">5. Config Writing Tutorials</a>
<ul class="sectlevel2">
<li><a href="#_config_on_openshift_workloads">5.1. Config on OpenShift (Workloads)</a></li>
<li><a href="#configs-on-osp">5.2. Config on OpenStack</a></li>
</ul>
</li>
<li><a href="#_contributing">6. Contributing</a>
<ul class="sectlevel2">
<li><a href="#_rules">6.1. Rules</a></li>
<li><a href="#_git">6.2. Git</a></li>
<li><a href="#_tips_and_links">6.3. Tips and links</a></li>
</ul>
</li>
<li><a href="#_faq">7. FAQ</a>
<ul class="sectlevel2">
<li><a href="#_deployment_stages">7.1. Deployment Stages</a></li>
<li><a href="#_cloud_providers">7.2. Cloud Providers</a></li>
<li><a href="#_aws_questions">7.3. AWS Questions</a></li>
</ul>
</li>
<li><a href="#_galaxy_and_external_roles">Galaxy and external roles</a>
<ul class="sectlevel1">
<li><a href="#_non_galaxy_external_roles">8. Non-Galaxy external roles</a></li>
<li><a href="#_development_workflow">9. Development workflow</a></li>
<li><a href="#_multiple_requirement_files">10. Multiple requirement files</a></li>
<li><a href="#_misc">11. Misc</a>
<ul class="sectlevel2">
<li><a href="#_user_stories_for_aad">11.1. User Stories for AAD</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="_agnosticd_configs"><a class="anchor" href="#_agnosticd_configs"></a><a class="link" href="#_agnosticd_configs">1. AgnosticD &amp; Configs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document gives an overview of the process of writing either a new <em>config</em>
 from scratch or copying and modifying an existing <em>config</em>.
Well designed <em>configs</em>, can easily and <strong>cleanly</strong> be abstracted to allow
 deployment to multiple different Public and Private Clouds including AWS,
  Azure.</p>
</div>
<div class="sect2">
<h3 id="_what_are_configs"><a class="anchor" href="#_what_are_configs"></a><a class="link" href="#_what_are_configs">1.1. What are <em>configs</em>?</a></h3>
<div class="paragraph">
<p>A <em>config</em> is simply a lab, workshop, or other deployment that has been defined
 and encapsulated in a series of playbooks, variable files, and templates in a
  <em>config</em> directory.
This allows <em>Ansible Agnostic Deployer</em> to deploy it simply and repeatedly on
 one or more Cloud Platforms.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_you_deploy_configs"><a class="anchor" href="#_how_you_deploy_configs"></a><a class="link" href="#_how_you_deploy_configs">1.2. How <strong>you</strong> Deploy <em>configs</em></a></h3>
<div class="paragraph">
<p><em>configs</em> are typically deployed via one of 3 methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the command line. A suitably configured Ansible Control Node, or
laptop, can invoke a new <em>config</em> deployment by invoking
 <code>ansible-playbook main.yml -e @./configs/&lt;CONFIG_NAME?sample_vars.yml</code> or other
   variable file with the appropriate parameters. See
    <a href="../ansible/configs/three-tier-app/README.adoc">Three Tier App</a>  for an
     example.</p>
</li>
<li>
<p>Via a front-end application such as Red Hat Cloud Forms or ServiceNow which
provides a user friendly catalog or "portal" type interface to the end user and
 can invoke the appropriate ansible command directly or via a "wrapper" script.</p>
</li>
<li>
<p>It is also possible to invoke a <em>config</em> by creating <strong>AgnosticD</strong> as an Ansible
Tower Project and defining <em>configs</em> as jobs. Going forward this pattern will
 influence the future evolution of <strong>AgnosticD</strong>.  Once a <em>config</em> is defined as
  a job it can either be directly invoked or via a front-end application or
   script making an API call to an Ansible Tower server.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_how_agnosticd_deploys_configs"><a class="anchor" href="#_how_agnosticd_deploys_configs"></a><a class="link" href="#_how_agnosticd_deploys_configs">1.3. How <strong>AgnosticD</strong> Deploys <em>configs</em></a></h3>
<div class="paragraph">
<p><strong>AgnosticD</strong> deploys <em>configs</em> via a 6 stage process, discussed in more detail
 below.
This provides <em>config</em> creators considerable flexibility, without undue
 complexity, to control the deployment process in a modular manner and enables
  you to abstract the Cloud Specific steps (e.g. <strong>AWS ec2</strong> or <strong>Microsoft Azure</strong>)
   from the application or OS specific steps. Greatly enhancing Cloud Portability.</p>
</div>
<div class="paragraph">
<p>The last point is key, as it allows developers to simply add new Cloud Platforms
 at a latter date, or provide their <em>configs</em> with multi-cloud support from day 1.
The term <strong>Cloud Provider</strong> includes the ability to add a virtualization platform
 (e.g. KVM, Hyper-V), Public Cloud Platform (e.g. Google Cloud Engine), or a
  container based platform such as OpenShift or Docker.</p>
</div>
<div class="paragraph">
<p>Currently supported platforms (via Cloud Providers):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS EC2</p>
</li>
<li>
<p>Azure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_a_typical_config"><a class="anchor" href="#_overview_of_a_typical_config"></a><a class="link" href="#_overview_of_a_typical_config">2. Overview of a Typical <em>Config</em></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Configs</em> are located in the <code>ansible/configs/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">README.adoc              linklight                 ocp-ha-disconnected-lab   quay-enterprise
ans-tower-lab            linklight-demo            ocp-ha-lab                rhte-ansible-net
ansible-cicd-lab         linklight-engine          ocp-implementation-lab    rhte-lb
ansible-provisioner      linklight-foundations     ocp-multi-cloud-example   rhte-oc-cluster-vms
archive                  linklight-networking      ocp-storage-cns           rhte-ocp-workshop
bu-workshop              linklight-networking-all  ocp-workloads             simple-multi-cloud
just-some-nodes-example  ocp-clientvm              ocp-workshop              three-tier-app
lightbulb                ocp-gpu-single-node       openshift-demos</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Above configs subject to change over time</em></p>
</div>
<div class="paragraph">
<p>A typical <em>Config</em> is well illustrated by <a href="../ansible/configs/three-tier-app/">Three Tier App</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">three-tier-app
├── README.adoc           # Config specific README
├── destroy_env.yml       # Teardown playbook to remove the config when finished
├── env_vars.yml          # Default vars containing configuration variables
├── files                 # Sub-directory for templates, cloud provider files etc
├── pre_infra.yml         # Stage 0 Playbook
├── post_infra.yml        # Stage 2 Playbook
├── pre_software.yml      # Stage 3 Playbook
├── software.yml          # Stage 4 Playbook
├── post_software.yml     # Stage 5 Playbook
├── sample_vars.yml       # Sample user supplied vars (cloud provider, ids etc)
└── topology.png          # Optional topology diagram</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../ansible/configs/three-tier-app/topology.png" alt="topology" width="100%">
</div>
</div>
<div class="sect2">
<h3 id="_sample_vars_yml"><a class="anchor" href="#_sample_vars_yml"></a><a class="link" href="#_sample_vars_yml">2.1. <code>sample_vars.yml</code></a></h3>
<div class="paragraph">
<p>Sample user supplied vars.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_vars_yml"><a class="anchor" href="#_default_vars_yml"></a><a class="link" href="#_default_vars_yml">2.2. <code>default_vars.yml</code></a></h3>
<div class="paragraph">
<p>Default vars containing configuration variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="_secret_yml"><a class="anchor" href="#_secret_yml"></a><a class="link" href="#_secret_yml">2.3. <code>secret.yml</code></a></h3>
<div class="paragraph">
<p><code>secret.yml</code> normally lives in your home direcotry - anywhere outside of the
AgnosticD repository itself. They should never be committed to Git!</p>
</div>
<div class="paragraph">
<p>Example secret files include;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>osp_auth_username: alice
osp_auth_password: toomanysecrets
...</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that these are sensitive credentials.</p>
</div>
<div class="paragraph">
<p>When running AgnosticD, it&#8217;s normal to "pass in" your secrets like this;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>user@host: ansible-playbook main.yml -e@~/secret.yml -e@configs/...</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_agnosticd_flow"><a class="anchor" href="#_agnosticd_flow"></a><a class="link" href="#_agnosticd_flow">3. AgnosticD Flow</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When ansible starts to deploy a <em>config</em> the process involves 2 logically
 distinct phases, Infrastructure and Software, each broken up into 3 Steps.
  This is illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/agnosticd_flow.png" alt="agnosticd flow" width="100%">
</div>
</div>
<div class="paragraph">
<p>AAD deployments start by invoking a common <code>main.yml</code> with an environmental
 variable file identifying the cloud platform to deploy plus other meta-data.</p>
</div>
<div class="paragraph">
<p>e.g. <code>ansible-playbook main.yml -e @configs/three-tier-app/sample_vars.yml</code></p>
</div>
<div class="listingblock">
<div class="title">Simplified execution flow of <code>main.yml</code></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">- import_playbook: "configs/{{ env_type }}/pre_infra.yml"
- import_playbook: "cloud_providers/{{ cloud_provider }}_infrastructure_deployment.yml"
- import_playbook: "configs/{{ env_type }}/post_infra.yml"
- import_playbook: "configs/{{ env_type }}/pre_software.yml"
- import_playbook: "configs/{{ env_type }}/software.yml"
- import_playbook: "configs/{{ env_type }}/post_software.yml"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <em>config</em> developers the above stages provide 5 <em>hooks</em> for customizing the
 configuration of your environment and 1 <em>hook</em> for customizing it for one or
  more cloud providers (e.g. AWS, Azure, etc).</p>
</div>
<div class="paragraph">
<p>An <em>example config</em> is provided by <code>ansible/configs/just-some-nodes-example</code></p>
</div>
<div class="sect2">
<h3 id="_stage_0_pre_infra_yml"><a class="anchor" href="#_stage_0_pre_infra_yml"></a><a class="link" href="#_stage_0_pre_infra_yml">3.1. Stage 0 <code>pre_infra.yml</code></a></h3>
<div class="paragraph">
<p>In this stage <strong>AAD</strong> is the entry playbook and is typical used for setting up
 any infrastructure etc prior to launching a cloud deployment. Typical tasks
  could include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating necessary ssh keys</p>
</li>
<li>
<p>Moving any ssh keys into place, setting permissions etc</p>
</li>
<li>
<p>Creating any payloads to be used in later stages e.g. repo files etc</p>
</li>
<li>
<p>Ensuring cloud credentials are available</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_stage_1_cloud_provider_deploy"><a class="anchor" href="#_stage_1_cloud_provider_deploy"></a><a class="link" href="#_stage_1_cloud_provider_deploy">3.2. Stage 1 Cloud Provider Deploy</a></h3>
<div class="paragraph">
<p>This stage is unique in the flow in that the <em>config</em> creator doesn&#8217;t supply a
 playbook but typically has to provide cloud specific configuration data.</p>
</div>
<div class="paragraph">
<p>Clouds are selected via the value of the <code>cloud_provider</code> variable and supported
 clouds can be found in <code>ansible/cloud_providers</code>. Currently supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Amazon Web Services (AWS)</p>
</li>
<li>
<p>Microsoft Azure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example: <strong>AWS</strong> configs use CloudFormations templates to deploy their
 infrastructure so this can be provided. Take a look at Three Tier Apps
  <a href="../ansible/configs/three-tier-app/files/cloud_providers/ec2_cloud_template.j2">Cloud Formation Template</a>.
   Notice it is written in Jinja2 and can easily be extended to deploy more, or
    less servers, plus you can change the Operating Systems, software payloads
     etc. This is done by overriding the default variables found in
      <a href="../ansible/configs/three-tier-app/env_vars.yml"><code>env_vars.yml</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A Cloud Creators document exists to facilitate adding further clouds to <strong>AAD</strong>. Wish
list items include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenShift</p>
</li>
<li>
<p>OpenStack</p>
</li>
<li>
<p>Google Cloud Engine (GCE)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_stage_2_post_infra_yml"><a class="anchor" href="#_stage_2_post_infra_yml"></a><a class="link" href="#_stage_2_post_infra_yml">3.3. Stage 2 <code>post_infra.yml</code></a></h3>
<div class="paragraph">
<p>In this stage <strong>AgnosticD</strong> can execute any <em>"post infrastructure"</em> tasks. It is
 not uncommon for this phase to do nothing but it provides a convenient hook for
  any tasks that may need to be run after building your Cloud Infrastructure. For
   example running any smoke tests that may be required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stage_3_pre_software_yml"><a class="anchor" href="#_stage_3_pre_software_yml"></a><a class="link" href="#_stage_3_pre_software_yml">3.4. Stage 3 <code>pre_software.yml</code></a></h3>
<div class="paragraph">
<p>At this point the infrastructure should be up and running but typically in a
 un-configured state. This stage provides a convenient hook for running any tasks
  that may be needed before software payload deployment. For example"</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Running any pre software tests</p>
</li>
<li>
<p>Setup software dependant yum repos or equivalent</p>
</li>
<li>
<p>Retrieving any licenses etc.</p>
</li>
<li>
<p><code>ssh</code> key housekeeping - for example inserting additional keys and configuration</p>
</li>
<li>
<p>Prepare <code>bastion</code> hosts or <code>jumpboxes</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_stage_4_software_yml"><a class="anchor" href="#_stage_4_software_yml"></a><a class="link" href="#_stage_4_software_yml">3.5. Stage 4 <code>software.yml</code></a></h3>
<div class="paragraph">
<p>In this stage <strong>AgnosticD</strong> deploys any software payloads onto the infrastructure.
 This could be as simple as installing Apache or as complex as installing and
  configuring an N-tier application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stage_5_post_software_yml"><a class="anchor" href="#_stage_5_post_software_yml"></a><a class="link" href="#_stage_5_post_software_yml">3.6. Stage 5 <code>post_software.yml</code></a></h3>
<div class="paragraph">
<p>In the final stage <strong>AgnosticD</strong> would typically perform a number of tasks including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any cleanup from the prior stages</p>
</li>
<li>
<p>Any end to end or component testing</p>
</li>
<li>
<p>User notification of the running configuration</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preparing_your_workstation"><a class="anchor" href="#_preparing_your_workstation"></a><a class="link" href="#_preparing_your_workstation">4. Preparing your workstation</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_red_hat_subscriptions"><a class="anchor" href="#_red_hat_subscriptions"></a><a class="link" href="#_red_hat_subscriptions">4.1. Red Hat subscriptions</a></h3>
<div class="ulist">
<ul>
<li>
<p>Some deployments would require a Red Hat Customer Portal account that has
appropriate subscriptions. This is not required for the playbook themselves.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Red Hat employee subscriptions can be used
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_agnosticd_from_a_container"><a class="anchor" href="#_agnosticd_from_a_container"></a><a class="link" href="#_agnosticd_from_a_container">4.2. AgnosticD from a Container</a></h3>
<div class="paragraph">
<p>It is possible to run agnosticd with containers. This way you just need a
container runtime. The <a href="../tools/builds">tools/builds</a> directory contains
Dockerfiles.</p>
</div>
<div class="sect3">
<h4 id="_docker_images_to_run_agnosticd"><a class="anchor" href="#_docker_images_to_run_agnosticd"></a><a class="link" href="#_docker_images_to_run_agnosticd">4.2.1. Docker images to run agnosticd</a></h4>
<div class="paragraph">
<p>We maintain several docker images to run agnosticd on the different Cloud providers.</p>
</div>
<div class="sect4">
<h5 id="_pull_images"><a class="anchor" href="#_pull_images"></a><a class="link" href="#_pull_images">Pull images</a></h5>
<div class="listingblock">
<div class="title">agnosticd-openstack</div>
<div class="content">
<pre>docker pull quay.io/gpte-devops-automation/agnosticd-openstack</pre>
</div>
</div>
<div class="listingblock">
<div class="title">agnosticd-aws</div>
<div class="content">
<pre>docker pull quay.io/gpte-devops-automation/agnosticd-aws</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_build_your_own_images"><a class="anchor" href="#_build_your_own_images"></a><a class="link" href="#_build_your_own_images">Build your own images</a></h5>
<div class="sect5">
<h6 id="_osp_provider"><a class="anchor" href="#_osp_provider"></a><a class="link" href="#_osp_provider">OSP provider</a></h6>
<div class="listingblock">
<div class="title">build agnosticd image for openstack</div>
<div class="content">
<pre>cd tools/builds
docker build . -f Dockerfile-openstack -t agnosticd-openstack</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_aws_provider"><a class="anchor" href="#_aws_provider"></a><a class="link" href="#_aws_provider">AWS provider</a></h6>
<div class="listingblock">
<div class="title">build agnosticd image for AWS</div>
<div class="content">
<pre>cd tools/builds
docker build . -f Dockerfile-aws -t agnosticd-aws</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_run"><a class="anchor" href="#_run"></a><a class="link" href="#_run">Run</a></h5>
<div class="listingblock">
<div class="title">run agnosticd, example with agnosticd-openstack</div>
<div class="content">
<pre>cd ansible  # when inside agnosticd repository
docker run -t \
  --mount source=$(pwd),target=/ansible,type=bind \
  --mount source=/home/fridim/secrets,target=/secrets,type=bind \
  --mount source=/tmp/output_dir,target=/tmp/output_dir,type=bind \
  -w /ansible \
  agnosticd-openstack \
  ansible-playbook main.yml \
    -e @configs/ocp4-disconnected-osp-lab/sample_vars.yml \
    -e @/secrets/osp.yml</pre>
</div>
</div>
<div class="listingblock">
<div class="title">run agnosticd, example with agnosticd-aws</div>
<div class="content">
<pre>cd ansible  # when inside agnosticd repository
docker run -t \
  --mount source=$(pwd),target=/ansible,type=bind \
  --mount source=/home/fridim/secrets,target=/secrets,type=bind \
  --mount source=/tmp/output_dir,target=/tmp/output_dir,type=bind \
  --mount source=~/.ssh,target=/root/.ssh,type=bind \
  -w /ansible \
  agnosticd-aws \
  ansible-playbook main.yml \
    -e @configs/ocp4-workshop/sample_vars.yml \
    -e @/secrets/gpte.yml</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_workstation_setup_for_openstack"><a class="anchor" href="#_workstation_setup_for_openstack"></a><a class="link" href="#_workstation_setup_for_openstack">4.3. Workstation setup for OpenStack</a></h3>
<div class="paragraph">
<p>Please see the <a href="#configs-on-osp">OpenStack tutorial</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_workstation_setup_for_aws"><a class="anchor" href="#_workstation_setup_for_aws"></a><a class="link" href="#_workstation_setup_for_aws">4.4. Workstation setup for AWS</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.python.org">Python</a></p>
</li>
<li>
<p><a href="http://docs.pythonboto.org">Python Boto</a> version 2.41 or greater</p>
</li>
<li>
<p><a href="http://github.com">Git</a> any version would do.</p>
</li>
<li>
<p><a href="https://github.com/ansible/ansible">Ansible</a> version 2.1.2 or greater</p>
</li>
<li>
<p><a href="https://s3.amazonaws.com/aws-cli/awscli-bundle.zip">awscli bundle</a> tested with version 1.11.32
Python and the Python dependencies may be installed via your OS' package manager
(eg: python2-boto on Fedora/CentOS/RHEL) or via <a href="https://pypi.python.org/pypi/pip">pip</a>. <a href="https://pypi.python.org/pypi/virtualenv">Python virtualenv</a> can also work.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
on Fedora, all dependencies are packaged and can be easily installed via
<code>dnf install wget git awscli python3-boto3 ansible ansible-lint yamllint</code>
(botocore and python will be pulled automatically through dependencies).
The lint tools are optional but are recommended tools to check the quality of your code.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example script to install required software</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Install basic packages
yum install -y  wget python python-boto unzip python2-boto3.noarch tmux git ansible

# Another option to configure python boto is:
git clone git://github.com/boto/boto.git
cd boto
python setup.py install

#Install boto3
pip install boto3

#Install pywinrm if you plan to deploy windows VMs
#pip install pywinrm

# Enable epel repositories for Ansible
cd /tmp
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
sudo yum -y install `ls *epel*.rpm`

# Install ansible and checked install version (required 2.2.0.0)
yum install -y ansible
ansible --version


## Install aws cli
curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
unzip awscli-bundle.zip
sudo ./awscli-bundle/install -i /usr/local/aws -b /bin/aws
aws --version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Mac OS installation steps:</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Install Python3
brew install python

# For python2 do
brew install python@2

# Depending on whether you did python3 or python2, use the pip3 or pip command
pip3 install boto3

#Install pywinrm if you plan to deploy windows VMs
#pip3 install pywinrm

# Install Ansible
pip3 install ansible

# Install awscli
brew install awscli</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_ec2_credentials"><a class="anchor" href="#_configure_the_ec2_credentials"></a><a class="link" href="#_configure_the_ec2_credentials">4.4.1. Configure the EC2 Credentials</a></h4>
<div class="ulist">
<ul>
<li>
<p>You will need to place your EC2 credentials in the ~/.aws/credentials file:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir ~/.aws
cat &lt;&lt; EOF &gt;&gt;  ~/.aws/credentials
[default]
aws_access_key_id = AKIAJAAYOURACCESSKEY
aws_secret_access_key = rT54UYOURSECRETACCESSKEY

EOF</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the SSH Key to the SSH Agent (optional)
If your operating system has an SSH agent and you are not using your default
configured SSH key, you will need to add the private key you use with your EC2
instances to your SSH agent:</p>
<div class="listingblock">
<div class="content">
<pre>ssh-add &lt;path to key file&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you use an SSH config that specifies what keys to use for what
hosts this step may not be necessary.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_aws_permissions_and_policies"><a class="anchor" href="#_aws_permissions_and_policies"></a><a class="link" href="#_aws_permissions_and_policies">4.4.2. AWS Permissions and Policies</a></h4>
<div class="paragraph">
<p>AWS credentials for the account above must be used with the AWS command line
 tool (detailed below)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An AWS IAM account with the following permissions:</p>
<div class="ulist">
<ul>
<li>
<p>Policies can be defined for Users, Groups or Roles</p>
</li>
<li>
<p>Navigate to: AWS Dashboard &#8594; Identity &amp; Access Management &#8594; Select Users or Groups or Roles &#8594; Permissions &#8594; Inline Policies &#8594; Create Policy &#8594; Custom Policy</p>
</li>
<li>
<p>Policy Name: openshift (your preference)</p>
</li>
<li>
<p>Policy Document:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "Stmt1459269951000",
            "Effect": "Allow",
            "Action": [
                "cloudformation:*",
                "iam:*",
                "route53:*",
                "elasticloadbalancing:*",
                "ec2:*",
                "cloudwatch:*",
                "autoscaling:*",
                "s3:*"
            ],
            "Resource": [
                "*"
            ]
        }
    ]
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Finer-grained permissions are possible, and pull requests are welcome.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_aws_existing_resources"><a class="anchor" href="#_aws_existing_resources"></a><a class="link" href="#_aws_existing_resources">4.4.3. AWS existing resources</a></h4>
<div class="ulist">
<ul>
<li>
<p>A route53
<a href="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html">public hosted zone</a>
 is required for the scripts to create the various DNS entries for the
   resources it creates. Two DNS entries will be created for workshops:</p>
<div class="ulist">
<ul>
<li>
<p><code>master.guid.domain.tld</code> - a DNS entry pointing to the master</p>
</li>
<li>
<p><code>*.cloudapps.guid.domain.tld</code> - a wildcard DNS entry pointing to the
router/infrastructure node</p>
</li>
</ul>
</div>
</li>
<li>
<p>An EC2 SSH keypair should be created in advance and you should save the key
file to your system.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">REGION=us-west-1
KEYNAME=ocpworkshop
openssl genrsa -out ~/.ssh/${KEYNAME}.pem 2048
openssl rsa -in ~/.ssh/${KEYNAME}.pem -pubout &gt; ~/.ssh/${KEYNAME}.pub
chmod 400 ~/.ssh/${KEYNAME}.pub
chmod 400 ~/.ssh/${KEYNAME}.pem
touch ~/.ssh/config
chmod 600 ~/.ssh/config
aws ec2 import-key-pair --key-name ${KEYNAME} --region=$REGION --output=text --public-key-material "`cat ~/.ssh/${KEYNAME}.pub | grep -v PUBLIC`"</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Key pairs are created per region, you will need to specify a different keypair for each region or duplicate the keypair into every region.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>REGIONS="ap-southeast-1 ap-southeast-2 OTHER_REGIONS..."
for REGION in `echo ${REGIONS}` ;
  do
    aws ec2 import-key-pair --key-name ${KEYNAME} --region=$REGION --output=text --public-key-material "`cat ~/.ssh/${KEYNAME}.pub | grep -v PUBLIC`"
  done</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_workstation_setup_for_azure"><a class="anchor" href="#_workstation_setup_for_azure"></a><a class="link" href="#_workstation_setup_for_azure">4.5. Workstation setup for Azure</a></h3>
<div class="paragraph">
<p>If you want to deploy on azure you will need the Azure client.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Source documentation</a></p>
</div>
<div class="listingblock">
<div class="title">in a nutshell (tested on fedora 28) - Azure cli (system-wide)</div>
<div class="content">
<pre># Install the azure-cli system-wide
sudo -i
rpm --import https://packages.microsoft.com/keys/microsoft.asc
cat &gt;&gt; /etc/yum.repos.d/azure-cli.repo &lt;&lt;EOF
[azure-cli]
name=Azure CLI
baseurl=https://packages.microsoft.com/yumrepos/azure-cli
enabled=1
gpgcheck=1
gpgkey=https://packages.microsoft.com/keys/microsoft.asc
EOF

yum check-update
yum install -y azure-cli</pre>
</div>
</div>
<div class="paragraph">
<p>We recommend you install the ansible module in a virtualenv.</p>
</div>
<div class="listingblock">
<div class="title">in a nutshell (tested on fedora 28) - Azure ansible module (use virtualenv)</div>
<div class="content">
<pre># /!\ careful this will update ansible as well
# Use a virtualenv for those:
pip install --upgrade pip
pip install --upgrade --force ansible[azure]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>--force</code> is used here, because of a known <a href="https://github.com/ansible/ansible/issues/38894">issue</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_service_principal"><a class="anchor" href="#_service_principal"></a><a class="link" href="#_service_principal">4.5.1. Service principal</a></h4>
<div class="paragraph">
<p>It&#8217;s better to use a service principal instead of your main credentials. Refer to the <a href="https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli?view=azure-cli-latest">official documentation</a>.</p>
</div>
<div class="listingblock">
<div class="title">in a nutshell</div>
<div class="content">
<pre>az login
az ad sp create-for-rbac
az login --service-principal -u &lt;user&gt; -p &lt;password-or-cert&gt; --tenant &lt;tenant&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">env_secret_vars.yml</div>
<div class="content">
<pre>azure_service_principal: "service principal client id"
azure_password: "service principal password or cert"
azure_tenant: "tenant ID"
azure_region: "Azure location, ex: EuropeWest"
azure_subscription_id: "Subscription id"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_virtualenv"><a class="anchor" href="#_virtualenv"></a><a class="link" href="#_virtualenv">4.5.2. Virtualenv</a></h4>
<div class="paragraph">
<p>If you want to use virtualenv, you can try &amp; adapt this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd ansible
mkdir ~/virtualenv-aad
virtualenv ~/virtualenv-aad -p python2.7
. ~/virtualenv-aad/bin/activate
export CC=gcc-5
pip install -r requirements.txt</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_config_writing_tutorials"><a class="anchor" href="#_config_writing_tutorials"></a><a class="link" href="#_config_writing_tutorials">5. Config Writing Tutorials</a></h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="https://travis-ci.org/redhat-cop/agnosticd"><img src="https://travis-ci.org/redhat-cop/agnosticd.svg?branch=development" alt="agnosticd"></a>
</div>
</div>
<div class="sect2">
<h3 id="_config_on_openshift_workloads"><a class="anchor" href="#_config_on_openshift_workloads"></a><a class="link" href="#_config_on_openshift_workloads">5.1. Config on OpenShift (Workloads)</a></h3>
<div class="paragraph">
<p>An <em>OpenShift Workload</em> is simply a workload that is applied to an existing,
 running, OpenShift cluster. For example if you wish to deploy 3Scale, Prometheus,
  or a MicroService application you can define it as a <em>Workload</em> then simply and
   consistently deploy it with a single command to your OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>This document assumes more than a passing familiarity with OpenShift but if
 you just want to "copy and hack" an existing Workload take a look at the
<a href="../ansible/roles/ocp-workload-3scale-demo/readme.adoc">OpenShift 3Scale</a> workload.</p>
</div>
<div class="paragraph">
<p>Other OpenShift Workloads  <a href="../ansible/roles">here.</a> OpenShift Workloads all begin
 <code>ocp-workload-</code> and follow the traditional structure of an Ansible Role.</p>
</div>
<div class="sect3">
<h4 id="_how_are_workloads_deployed"><a class="anchor" href="#_how_are_workloads_deployed"></a><a class="link" href="#_how_are_workloads_deployed">5.1.1. How are <em>Workloads</em> Deployed?</a></h4>
<div class="paragraph">
<p>OpenShift <em>Workloads</em> are deployed by applying an Ansible <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">role</a> to an existing, running, cluster.</p>
</div>
<div class="paragraph">
<p>New and existing <em>workloads</em> can be deployed, and developed, on any OpenShift
 cluster including locally on your laptop (<code>oc cluster</code> and <code>Minishift</code>).</p>
</div>
<div class="paragraph">
<p>Each <em>Workload</em> Role includes a detailed <code>README.adoc</code> and they are applied by
 invoking the <code>ocp-workload</code> <em>config</em>.which is actually a Playbook and will apply
  the workload in the value <code>ocp_workload</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook -i localhost, -c local ./configs/ocp-workloads/ocp-workload.yml \
                    -e ocp_workload=ocp-workload-3scale-multitenant \
                    -e ACTION=create \
                    -e subdomain_base=$SUBDOMAIN_BASE \
                    -e admin_username=$ADM_USERNAME</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configs-on-osp"><a class="anchor" href="#configs-on-osp"></a><a class="link" href="#configs-on-osp">5.2. Config on OpenStack</a></h3>
<div class="paragraph">
<p>In this document we will explain how one could setup their laptop for AgnosticD deployment with OpenStack.</p>
</div>
<div class="paragraph">
<p>If you are a Red Hatter, you can use <a href="rhpds.redhat.com">rhpds.redhat.com</a> to request access to our OpenStack cluster.
. Log in to <a href="https://rhpds.opentlc.com">https://rhpds.redhat.com</a> using your opentlc user.
. Go to <strong>Services</strong> &#8594; <strong>Catalogs</strong> &#8594; <strong>Events Development</strong> &#8594; <strong>Summit DEV OSP Sandbox</strong>.
. Click <strong>Order</strong> &#8594; <strong>Submit</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will receive three emails indicating the status of the environment and instructions for accessing the environment.
In the third email you receive all information you need to login to the client machine that would have the rest of required information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can use the VM as your ansible host or copy the files over to your laptop and work locally.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configure_your_environment_for_running_openstack_ansible"><a class="anchor" href="#_configure_your_environment_for_running_openstack_ansible"></a><a class="link" href="#_configure_your_environment_for_running_openstack_ansible">5.2.1. Configure your environment for running OpenStack Ansible</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
on Fedora <code>dnf install python3-openstacksdk python3-openstackclient python-openstackclient-doc python-openstackclient-lang python3-heatclient python-heatclient-doc python3-dns</code> will do the job (you may choose to skip doc and lang packages).
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please make sure the file <code>/etc/ansible/hosts</code> doesn&#8217;t exist or is empty, otherwise this default inventory file will cause problems later.</p>
</li>
<li>
<p>Install <code>virtualenv</code> and <code>pip3</code> (On your laptop or on the clientVM):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># on Linux
$ sudo yum install python3-pip python-virtualenv -y
# on Mac
$ brew install python pyenv-virtualenv</code></pre>
</div>
</div>
</li>
<li>
<p>Create virtualenv environment and download python requirements:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create virtualenv and activate</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ virtualenv openstack-ansible-2.9

##In Mac
$ pyenv virtualenv openstack-ansible-2.9


## In Mac, if you find the error " the error: error: pyenv: pip: command not found]", it could because you need pip3, in that case please do:
$ alias pip=pip3
$ pip install --upgrade pip

$ source openstack-ansible-2.9/bin/activate

## In Mac
$ source /Users/[USER]/.pyenv/versions/openstack-ansible-2.9/bin/activate

## ^replace [USER] with your username or the proper path</code></pre>
</div>
</div>
</li>
<li>
<p>Install the python modules inside that virtualenv</p>
<div class="ulist">
<ul>
<li>
<p>On Mac</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ pip3 install -r https://raw.githubusercontent.com/redhat-cop/agnosticd/development/ansible/configs/ocp4-disconnected-osp-lab/files/macos_requirements.txt</code></pre>
</div>
</div>
</li>
<li>
<p>On Linux with Python 2</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">(openstack-ansible-2.9) $ pip install -r https://raw.githubusercontent.com/redhat-cop/agnosticd/development/tools/virtualenvs/openstack-ansible-2.9-python2.txt</code></pre>
</div>
</div>
</li>
<li>
<p>On Linux with python 3:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">(openstack-ansible-2.9) $ pip install -r https://raw.githubusercontent.com/redhat-cop/agnosticd/development/tools/virtualenvs/openstack-ansible-2.9-python3.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Multi-platform, latest modules (should work for all with both python2 and python3)</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">(openstack-ansible-2.9) $ pip install -r https://raw.githubusercontent.com/redhat-cop/agnosticd/development/tools/virtualenvs/openstack-ansible-latest.txt</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre># Install python modules needed by ansible
sudo pip install openstacksdk

# Install openstack CLIs
sudo pip install python-openstackclient python-heatclient</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getting_your_openstack_credentials"><a class="anchor" href="#_getting_your_openstack_credentials"></a><a class="link" href="#_getting_your_openstack_credentials">5.2.2. Getting your OpenStack Credentials</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>~/.config/openstack/clouds.yaml</code> file on your laptop using the information provided in the final email.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ mkdir -p ~/.config/openstack
$ vim ~/.config/openstack/clouds.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Review your <code>~/.config/openstack/clouds.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat ~/.config/openstack/clouds.yaml
clouds:
  35eb-project:
    auth:
      auth_url: "http://169.47.17.15:5000/v3"
      username: "35eb-user"
      project_name: "35eb-project"
      project_id: "1a79cf800ff94754bb495e2c1fd9d433"
      user_domain_name: "Default"
      password: "YOUR_TEMP_PASSWORD"
    region_name: "regionOne"
    interface: "public"
    identity_api_version: 3</code></pre>
</div>
</div>
</li>
<li>
<p>Check that your credentials are working:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ openstack --os-cloud=GUID-project server list
+--------------------------------------+-----------+--------+------------------------------------------------+-------+---------+
| ID                                   | Name      | Status | Networks                                       | Image | Flavor  |
+--------------------------------------+-----------+--------+------------------------------------------------+-------+---------+
| 653fb842-6ce8-4eb0-a51a-dc0f3d5fb103 | bastion   | ACTIVE | 35eb-ocp-network=192.168.47.33, 169.47.183.214 |       | 2c2g30d |
+--------------------------------------+-----------+--------+------------------------------------------------+-------+---------+</code></pre>
</div>
</div>
</li>
<li>
<p>Try to login to OpenStack UI: <a href="http://horizon.red.osp.opentlc.com/dashboard/auth/login/" class="bare">http://horizon.red.osp.opentlc.com/dashboard/auth/login/</a>. You must use the credentials from <code>.config/openstack/clouds.yaml</code> to login to the UI.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_agnosticd_and_your_development_environment"><a class="anchor" href="#_setting_up_agnosticd_and_your_development_environment"></a><a class="link" href="#_setting_up_agnosticd_and_your_development_environment">5.2.3. Setting up AgnosticD and your development environment</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the AgnosticD repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git clone https://github.com/redhat-cop/agnosticd</code></pre>
</div>
</div>
</li>
<li>
<p>Create your <code>secret.yml</code> file <strong>oustide the repository</strong>, and edit it using the correct credentials based on your <code>clouds.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt; EOF &gt;&gt; ~/secret.yml
# Authenication for OpenStack in order to create the things
# RED
osp_auth_username: CHANGEME
osp_auth_password: CHANGEME
osp_project_name: CHANGEME
osp_project_id: CHANGEME


osp_auth_url: http://169.47.188.15:5000/v3
osp_auth_project_domain: default
osp_auth_user_domain: default

# DNS

osp_cluster_dns_server: ddns01.opentlc.com
osp_cluster_dns_zone: students.osp.opentlc.com
ddns_key_name: PROVIDED_BY_ADMIN          # default value is set to "hmac-dm5"
ddns_key_secret: PROVIDED_BY_ADMIN

# Repo

own_repo_path: PROVIDED_BY_ADMIN

# Do not create PROJECT, we already have one and want to use it

osp_project_create: false

EOF</code></pre>
</div>
</div>
</li>
<li>
<p><strong>First checkpoint</strong>, make sure this secret file is correct by running the test-empty-config.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd agnosticd/ansible

ansible-playbook main.yml \
  -e @configs/test-empty-config/sample_vars_osp.yml \
  -e @~/secret.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>sample_vars.yml</code> file and call it <code>my_vars.yml</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cp configs/just-some-nodes-example/sample_vars_osp.yml \
  configs/just-some-nodes-example/my_vars.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>my_vars.yml</code> and change the <code>guid</code> value to something short and unique.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not pick the same GUID as the one you got for access to the OSP cluster.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Second checkpoint</strong>, Run the ansible-playbook command to deploy just-some-nodes-example</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook main.yml \
  -e @configs/just-some-nodes-example/my_vars.yml \
  -e @~/secret.yml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are having python2 Vs. Python3 issues, Add <code>/usr/bin/python3.6</code> before the ansible-playbook command. For example: <code>/usr/bin/python3.6 ansible-playbook ansible/main.yml -e @configs/just-some-nodes-example/my_vars.yml -e@~/secret.yml</code>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check that the VM was installed and ssh into the box using the created key</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">openstack --os-cloud=35eb-project server list
ssh -i /tmp/output_dir/${GUID}_infra_ssh_key.pem cloud-user@169.47.183.41</code></pre>
</div>
</div>
</li>
<li>
<p>You can now adapt <code>my_vars.yml</code> to your needs. Create different kind of instances, more security groups, etc.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_clean_up"><a class="anchor" href="#_clean_up"></a><a class="link" href="#_clean_up">5.2.4. Clean up</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Destroy the deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook destroy.yml \
  -e @configs/just-some-nodes-example/my_vars.yml \
  -e @~/secret.yml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_whats_next"><a class="anchor" href="#_whats_next"></a><a class="link" href="#_whats_next">5.2.5. What&#8217;s next ?</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="../ansible/configs/ocp-workloads">ocp-workloads</a>: deploy an OpenShift app on a shared cluster. See <a href="../ansible/configs/ocp-workloads/sample_vars"><code>sample_vars</code></a> directory.</p>
</li>
<li>
<p><a href="../ansible/configs/ocp4-cluster">ocp4-cluster</a>: deploy an OpenShift cluster. You can applied your workloads on top of it using the <code>ocp_workloads</code> list. See <a href="../ansible/configs/ocp4-cluster/sample_vars_osp.yml">sample_vars_osp.yml</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing"><a class="anchor" href="#_contributing"></a><a class="link" href="#_contributing">6. Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re reading this, hopefully you are considering helping out with the Ansible Agnostic Deployer for Red Hat enablement.</p>
</div>
<div class="paragraph">
<p>Herein lies the contribution guidelines for helping out with this project. Do take the guidelines here literally, if you find issue with any of them or you see room for improvement, please let us know via a GitHub issue.</p>
</div>
<div class="sect2">
<h3 id="_rules"><a class="anchor" href="#_rules"></a><a class="link" href="#_rules">6.1. Rules</a></h3>
<div class="ulist">
<ul>
<li>
<p>The Ansible <a href="#coc">Code of Conduct</a> still applies.</p>
</li>
<li>
<p>For git messages, branch names, &#8230;&#8203;, follow <a href="#gitstyle">Git Style Guide</a></p>
</li>
<li>
<p>Should you wish to work on a completely new standard, GREAT, but please file an issue for tracking.</p>
</li>
<li>
<p>To contribute, fork and make a pull request against the <code>development</code> branch.</p>
</li>
<li>
<p>All tasks should be in YAML literal.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"># This
- name: Create a directory
  file:
      state: directory
      path: /tmp/deletethis

# Not this
- name: Create a directory
  file: state=directory path=/tmpt/deletethis</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>There should be no space before a task hyphen</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml"># This
- name: Do something

# Not this
   - name: Do something</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Module arguments should be indented two spaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml"># This
- name: Create a directory
  file:
    state: directory
    path: /tmp/deletethis

# Not This
- name: Create a directory
  file:
      state: directory
      path: /tmp/deletethis</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>There should be a single line break between tasks</p>
</li>
<li>
<p>Tags should be in multi-line format and indented two spaces just like module arguments above</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"># This
- name: "Check hosts.equiv"
  stat:
    path: /etc/hosts.equiv
  register: hosts_equiv_audit
  always_run: yes
  tags:
    - tag1
    - tag2


# Not This
- name: "Check hosts.equiv"
  stat:
      path: /etc/hosts.equiv
  register: hosts_equiv_audit
  always_run: yes
  tags: [tag1,tag2]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Every task must be named and provide brief descriptions about the task being accomplished.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_git"><a class="anchor" href="#_git"></a><a class="link" href="#_git">6.2. Git</a></h3>
<div class="paragraph">
<p>Please follow the <a href="#gitstyle">Git style guide</a>.</p>
</div>
<div class="paragraph">
<p>Note: during the review process, you may add new commits to address review comments or change existing commits. However, before getting your PR merged, please squash commits to a minimum set of meaningful commits.</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve broken your work up into a set of sequential changes and each commit pass the tests on their own then that&#8217;s fine. If you&#8217;ve got commits fixing typos or other problems introduced by previous commits in the same PR, then those should be squashed before merging.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tips_and_links"><a class="anchor" href="#_tips_and_links"></a><a class="link" href="#_tips_and_links">6.3. Tips and links</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History">Rewriting Git History</a></p>
</li>
<li>
<p><a href="http://gitready.com/advanced/2009/02/10/squashing-commits-with-rebase.html">Squashing commits with rebase</a></p>
</li>
<li>
<p><a href="http://docs.ansible.com/ansible/community.html#community-code-of-conduct">Code of Conduct</a><a id="coc"></a></p>
</li>
<li>
<p><a href="https://github.com/agis/git-style-guide">Git Style Guide</a><a id="gitstyle"></a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq"><a class="anchor" href="#_faq"></a><a class="link" href="#_faq">7. FAQ</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_deployment_stages"><a class="anchor" href="#_deployment_stages"></a><a class="link" href="#_deployment_stages">7.1. Deployment Stages</a></h3>
<div class="sect3">
<h4 id="_can_i_bypass_one_or_more_stages"><a class="anchor" href="#_can_i_bypass_one_or_more_stages"></a><a class="link" href="#_can_i_bypass_one_or_more_stages">7.1.1. Can I bypass one or more stages?</a></h4>
<div class="paragraph">
<p>Yes, <code>main.yml</code> tags each stage, use <code>--skip-tags</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_where_should_i_store_credentails"><a class="anchor" href="#_where_should_i_store_credentails"></a><a class="link" href="#_where_should_i_store_credentails">7.1.2. Where should I store credentails?</a></h4>
<div class="paragraph">
<p>Never inside the repo. A common pattern is to store them in the home directoy
of the user who executes <code>ansible-playbook</code>. For example <code>~/.ssh</code> for ssh keys,
<code>~/.aws/credentials</code> for AWS etc.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cloud_providers"><a class="anchor" href="#_cloud_providers"></a><a class="link" href="#_cloud_providers">7.2. Cloud Providers</a></h3>
<div class="sect3">
<h4 id="_can_i_bypass_stage_1_cloud_providers_completely"><a class="anchor" href="#_can_i_bypass_stage_1_cloud_providers_completely"></a><a class="link" href="#_can_i_bypass_stage_1_cloud_providers_completely">7.2.1. Can I bypass Stage 1 Cloud Providers completely?</a></h4>
<div class="paragraph">
<p>Yes. See <code>configs/linklight/README</code> for an example and use <code>--skip-tags=deploy_infrastructure</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aws_questions"><a class="anchor" href="#_aws_questions"></a><a class="link" href="#_aws_questions">7.3. AWS Questions</a></h3>
<div class="sect3">
<h4 id="_can_i_use_aws_profiles"><a class="anchor" href="#_can_i_use_aws_profiles"></a><a class="link" href="#_can_i_use_aws_profiles">7.3.1. Can I use AWS Profiles?</a></h4>
<div class="paragraph">
<p>Maybe&#8230;&#8203;</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_galaxy_and_external_roles" class="sect0"><a class="anchor" href="#_galaxy_and_external_roles"></a><a class="link" href="#_galaxy_and_external_roles">Galaxy and external roles</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>To use galaxy roles in your config, just do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <code>requirements.yml</code> file in the config directory, for example:</p>
<div class="listingblock">
<div class="title"><code>ansible/configs/{{env_type}}/requirements.yml</code></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
- src: geerlingguy.docker
  name: docker
  version: '2.5.1'</code></pre>
</div>
</div>
</li>
<li>
<p>Use the role in the playbooks</p>
<div class="listingblock">
<div class="title"><code>ansible/configs/{{env_type}}/pre_software.yml</code></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- name: Some play
  hosts:
    - myhosts
  become: true
  gather_facts: False
  tasks:
    - name: install docker
      include_role:
        name: docker</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Note that in the previous example, we use <code>include_role</code> which is <strong>dynamic</strong>. If you try to use the role with <code>role</code> or <code>import_role</code> it will fail because the role is dynamically downloaded at runtime.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Please use a pinned <code>version</code> in the <code>requirements.yml</code> file so the success of the deployment of your config does not depend on the stability of upstream galaxy roles.</p>
</div>
<div class="listingblock">
<div class="title">Make sure you use version pinning in <code>requirements.yml</code></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- src: geerlingguy.docker
  name: docker
  version: '2.5.1'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you run Ansible Agnostic Deployer, it will automatically fetch and create the role in your config directory: <code>ansible/configs/{{env_type}}/roles/docker</code> for example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_non_galaxy_external_roles"><a class="anchor" href="#_non_galaxy_external_roles"></a><a class="link" href="#_non_galaxy_external_roles">8. Non-Galaxy external roles</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Roles in <code>requirements.yml</code> don&#8217;t have to be in Galaxy, you can use any git repo.</p>
</div>
<div class="listingblock">
<div class="title">Another example of <code>requirements.yml</code> with git repo</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
# External role to setup grader host virtualenv and FTL grading infra

- src: https://github.com/redhat-gpte-devopsautomation/ftl-injector
  name: ftl-injector
  version: v0.7</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_workflow"><a class="anchor" href="#_development_workflow"></a><a class="link" href="#_development_workflow">9. Development workflow</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>During development, the roles will be deployed and get in your way git-wise. To avoid that, there is a rule in the top-level <a href="../.gitignore"><code>.gitignore</code></a> to ignore those dynamic roles:</p>
</div>
<div class="listingblock">
<div class="title">gitignore</div>
<div class="content">
<pre>ansible/configs/*/roles</pre>
</div>
</div>
<div class="paragraph">
<p>The convention is:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>the "static" roles, those versioned in this repository, must live in <a href="../ansible/roles"><code>ansible/roles</code></a> and the "dynamic" roles in your config directory <code>ansible/configs/{{env_type}}/roles</code>.</p>
</div>
</blockquote>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Dynamic roles are not pushed in git, only the <code>requirements.yml</code> file is versioned.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_requirement_files"><a class="anchor" href="#_multiple_requirement_files"></a><a class="link" href="#_multiple_requirement_files">10. Multiple requirement files</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes, for the same config, we need several <code>requirements.yml</code>. For example, one for PROD, one for DEV, etc.</p>
</div>
<div class="paragraph">
<p>You can create as many files as you want. When calling the playbook just override the <code>requirements_path</code> variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook main.yml -e requirements_path=ansible/configs/{{env_type}}/requirements-prod.yml [...]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc"><a class="anchor" href="#_misc"></a><a class="link" href="#_misc">11. Misc</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_user_stories_for_aad"><a class="anchor" href="#_user_stories_for_aad"></a><a class="link" href="#_user_stories_for_aad">11.1. User Stories for AAD</a></h3>
<div class="ulist">
<ul>
<li>
<p>A new product was acquired by Red Hat and the Architect wants to provide a new product as part of a deployable environment with AAD</p>
</li>
<li>
<p>It&#8217;s time consuming to put together environments. The Engineer wants to re-use deployment and configuration management for a product that&#8217;s already implemented in AAD to provide it integrated with another product.</p>
</li>
<li>
<p>There&#8217;s a new feature in OpenShift, and the Enineer wants to implement a feature in a product that will only impact a subset of the users of a product, and the engineers who rely on the product in their environments.</p>
</li>
<li>
<p>The SA wants to deliver a demo, and test their environment immediately before a demo, and clean up test data so the demo will be pristine.</p>
</li>
<li>
<p>The SA Manager wants needs to track effort and spending per opporunity, and wants a report of each her SA&#8217;s activities, and a cost-per-opportunity report.</p>
</li>
<li>
<p>The Enablement Architect wants to set a date to automatically destroy student envionrments.</p>
</li>
<li>
<p>The Enablement Architect wants to increase lab testing velocity by deploying environments via API.</p>
</li>
<li>
<p>The Enablement Architect wants to teach in a situation where two environments networked together, so multiple clusters can intercommunicate.</p>
</li>
<li>
<p>The Operators want a dashboard of environments as they launch, run, and are destroyed. Example: It&#8217;s difficult to respond to the question, "Are there any problems deploying or destroying any environments?  Operators cannot quickly see the entire operational landscape of the system.</p>
</li>
<li>
<p>The Architect wants a new cloud service feature added to an environment.  Example: New class requirements demand object storage for environemtns. So, S3 buckets with quotas need to be setup for each environment.</p>
</li>
<li>
<p>The SA wants to use AAD to create a demo of Quay for their customer from a basic deployment, as an upstream of a new OpenShift Cluster with Jenkins CI, a test Java application and user policies for dev/test/qa/admin/security. Quay will use Clair to check images.  There will be geo-replication of the underlying Quay datastore (S3 or the like).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-03-23 19:31:55 UTC
</div>
</div>
</body>
</html>