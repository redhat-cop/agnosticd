---
- import_tasks: detect_project.yml

# If project exists
- when: osp_project_info | length > 0
  block:
    - when: osp_project_create | bool
      include_tasks: project_resources.yml

    # Delete the heat stack **after** resources:
    # The heat stack creates resources like network and router.
    # Over the course of the lifetime of a project, users may
    # create instances, ports, etc. that are outside of the heat
    # stack. If you try to tear the heat stack down without deleting
    # those extra ports, for instance, the heat stack teardown will fail.
    - include_tasks: heat.yml

    - when: osp_project_create | bool
      name: Delete the project
      os_project:
        name: "{{ osp_project_name }}"
        state: absent
      tags:
        - full_delete

# If project doesn't exist
- when: osp_project_info | length == 0
  debug:
    msg: "No project found for {{ osp_project_name }}. Nothing done."
