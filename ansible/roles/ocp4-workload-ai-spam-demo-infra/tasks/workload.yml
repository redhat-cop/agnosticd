# vim: set ft=ansible
---

# Implement your Workload deployment tasks here

- name: Install Open Data Hub CRD
  k8s:
    state: present
    definition: "{{ lookup('file', 'opendatahub_v1alpha1_opendatahub_crd.yaml') }}"

- name: Create an opendatahub-admin cluster role
  k8s:
    state: present
    definition:
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRole
      metadata:
        name: opendatahub-admin
      rules:
        - apiGroups:
            - opendatahub.io
          resources:
            - '*'
          verbs:
            - '*'

- name: Install Seldon CRD and ClusterRole
  k8s:
    state: present
    definition: "{{ item }}"
  with_items:
    - "{{ lookup('file', 'seldon/seldon-crd.yaml') }}"
    - "{{ lookup('file', 'seldon/seldon-user.clusterrole.yaml') }}"

- name: Install Kafka CRDs and ClusterRoles
  k8s:
    state: present
    definition: "{{ item }}"
  with_items:
    - "{{ lookup('file', 'kafka/kafka.crd.yaml') }}"
    - "{{ lookup('file', 'kafka/kafka.clusterrole.yaml') }}"

# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool
