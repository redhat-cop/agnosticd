---
# Implement your Workload deployment tasks here

- name: Setting up workload for user
  debug:
    msg: "Setting up workload for user ocp_username = {{ ocp_username }}"

- name: "Creating temp directory for operator repo"
  tempfile: 
    state: directory
    suffix: mig-operator
  register: repodir

- name: "Checking out operator repo"
  git:
    repo: "{{ mig_operator_repo }}"
    dest: "{{ repodir.path }}"
    version: "{{ mig_operator_repo_branch }}"

- name: "Creating controller and operator"
  become: true
  ignore_errors: true
  shell: "oc apply -f {{ repodir.path }}/deploy/non-olm/{{ mig_operator_version }}/{{ item }}"
  loop:
    - "operator.yml"
    - "controller-{{ mig_ocp_version }}.yml"

# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool
