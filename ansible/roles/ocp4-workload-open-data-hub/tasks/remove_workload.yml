# vim: set ft=ansible
---

# Implement your Workload deployment tasks here

- name: remove the open-data-hub rook-ceph rook-ceph-system project 
  k8s:
    state: absent
    definition:
      apiVersion: project.openshift.io/v1
      kind: Project
      metadata:
        name: "{{ item }}"
  loop:
    - open-data-hub
    - rook-ceph
    - rook-ceph-system

- name: remove SCC.yaml
  k8s:
    state: absent
    definition:
      kind: SecurityContextConstraints
      apiVersion: security.openshift.io/v1
      metadata:
        name: rook-ceph

- name: Ensure project is done terminating if it was being terminated
  k8s_facts:
    api_version: project.openshift.io/v1
    kind: Project
    name: "{{ item }}"
  register: result
  failed_when: result.resources | length > 0
  delay: 15
  retries: 60
  until: result.resources | length == 0
  loop:
    - open-data-hub
    - rook-ceph
    - rook-ceph-system

# Leave this as the last task in the playbook.
- name: remove_workload tasks complete
  debug:
    msg: "Remove Workload tasks completed successfully."
  when: not silent|bool