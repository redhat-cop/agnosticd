---
- name: remove projects
  vars:
    t_project_name: "{{ project_name }}-{{ item[1] }}java{{ item[0] }}"
  k8s:
    api_version: project.openshift.io/v1
    kind: Project
    name: "{{ t_project_name }}"
    state: absent
  loop: "{{ java_versions | product(app_kinds) | list }}"

- name: remove AMQ Streams subscription
  k8s:
    api_version: operators.coreos.com/v1alpha1
    kind: Subscription
    name: amq-streams
    namespace: openshift-operators
    state: absent

- name: remove container security subscription
  k8s:
    api_version: operators.coreos.com/v1alpha1
    kind: Subscription
    name: container-security-operator
    namespace: openshift-operators
    state: absent

- name: Get cluster service versions
  k8s_info:
    api_version: operators.coreos.com/v1alpha1
    namespace: openshift-operators
    kind: ClusterServiceVersion
  register: r_cluster_service_versions

- name: Remove cluster service versions
  k8s:
    api_version: operators.coreos.com/v1alpha1
    namespace: openshift-operators
    kind: ClusterServiceVersion
    name: "{{ t_csv_name }}"
    state: absent
  loop: "{{ r_cluster_service_versions | json_query('resources[*].metadata.name') | select('search', '^(amq|container-security)') | list }}"
  loop_control:
    loop_var: t_csv_name

- name: Delete temp dir
  file:
    state: absent
    path: "{{ temp_dir }}"

- name: remove_workload tasks complete
  debug:
    msg: "Remove Workload tasks completed successfully."
  when: not silent | bool
