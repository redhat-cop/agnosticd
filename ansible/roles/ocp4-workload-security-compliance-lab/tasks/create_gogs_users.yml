---

- name: create gogs admin user
  uri:
    url: http://{{ ocp4_dso_gogs_urlprefix }}.{{ route_subdomain }}/user/sign_up
    method: POST
    body: "user_name={{ ocp4_dso_gogs_admin_user }}&password={{ ocp4_dso_gogs_admin_password }}&&retype={{ ocp4_dso_gogs_admin_password }}&&email={{ ocp4_dso_gogs_admin_user }}@gogs.com"
    headers:
      Content-Type: "application/x-www-form-urlencoded"
    status_code: 302,200

- name: check if user exists
  uri:
    url: http://{{ ocp4_dso_gogs_urlprefix }}.{{ route_subdomain }}/api/v1/users/{{ ocp4_dso_gogs_user }}
    user: "{{ ocp4_dso_gogs_admin_user }}"
    password: "{{ ocp4_dso_gogs_admin_password }}"
    force_basic_auth: true
    status_code: 200,404
  register: user_result

- name: create gogs user
  uri:
    url: http://{{ ocp4_dso_gogs_urlprefix }}.{{ route_subdomain }}/api/v1/admin/users
    method: POST
    body: "{'login_name': '{{ ocp4_dso_gogs_user }}', 'username': '{{ ocp4_dso_gogs_user }}', 'email': '{{ ocp4_dso_gogs_user }}@gogs.com', 'password': '{{ ocp4_dso_gogs_user_password }}'}"
    body_format: json
    user: "{{ ocp4_dso_gogs_admin_user }}"
    password: "{{ ocp4_dso_gogs_admin_password }}"
    status_code: 200,201
    force_basic_auth: true
  when: user_result.status != 200

- name: generate gogs users
  uri:
    url: http://{{ ocp4_dso_gogs_urlprefix }}.{{ route_subdomain }}/api/v1/admin/users
    method: POST
    body: "{'login_name': '{{ item }}', 'username': '{{ item }}', 'email': '{{ item }}@gogs.com', 'password': '{{ ocp4_dso_gogs_user_password }}'}"
    body_format: json
    user: "{{ ocp4_dso_gogs_admin_user }}"
    password: "{{ ocp4_dso_gogs_admin_password }}"
    status_code: 200,201
    force_basic_auth: true
  ignore_errors: true
  with_sequence: start=0 end={{ ocp4_dso_gogs_generate_user_count }} format="{{ ocp4_dso_user_format }}"
  when: ocp4_dso_gogs_generate_user_count|int >= 0
