---

- name: Run Integreatly installer
  shell: |
          ansible-playbook -i "{{ inventory_hosts_file }}" \
          playbooks/install.yml -e eval_self_signed_certs="{{ self_signed_certs_enabled }}"
  args:
    chdir: "{{ install_dir }}/evals"

- name: Retrieve Openshift master public URL
  slurp:
    src: "{{ openshift_master_config_path }}"
  register: openshift_master_config

- name: Retrieve Web App URL
  shell: oc get route/tutorial-web-app -o template --template \{\{.spec.host\}\} -n "{{ webapp_namespace }}"
  register: webapp_route

- set_fact:
    openshift_master_url: "{{ (openshift_master_config['content'] | b64decode | from_yaml)['masterPublicURL'] }}"

- name: Print Overview
  debug:
    msg: "{{ item }}"
  with_items:
    - "user.info: Integreatly Workshop Overview"
    - "user.info: Openshift Master Console: {{ openshift_master_url }}"
    - "user.info: Web App URL: https://{{ webapp_route.stdout }}"
    - "user.info: Cluster Admin User: {{ admin_username }} / {{ admin_password }}"
    - "user.info: Evaluation User: {{ evals_username }} / {{ evals_password }}"
    - "user.info: Pre-seeded Evaluation Users: evals{01..50}@example.com / {{ evals_password }}"

- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool
