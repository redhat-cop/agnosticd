---
- name: "Creating common CRs"
  shell: "oc apply -f {{ tmp_dir.path }}/{{ item }}"
  loop:
    - "namespace.yaml"
    - "secret.yaml"
    - "sa.yaml"
    - "pvc.yaml"
  when: not mssql_workload_destroy|bool

- name: "Creating new scc"
  shell: "oc apply -f {{ tmp_dir.path }}/scc.yaml"
  ignore_errors: yes
  when: not mssql_workload_destroy|bool

- name: "Removing common CRs"
  shell: "oc delete --ignore-not-found -f {{ tmp_dir.path }}/{{ item }}"
  loop:
    - "sa.yaml"
    - "namespace.yaml"
    - "scc.yaml"
  when: mssql_workload_destroy|bool

- name: "Creating MsSQL CRs"
  shell: "oc apply -f {{ tmp_dir.path }}/{{ item }}"
  loop:
    - "deployment.yaml"
    - "service.yaml"
  when: not mssql_workload_destroy|bool

- name: "Creating MsSQL sample app CRs"
  shell: "oc apply -f {{ tmp_dir.path }}/{{ item }}"
  loop:
    - "app-deployment.yaml"
    - "app-service.yaml"
    - "app-route.yaml"
  when: not mssql_workload_destroy|bool

- name: "Cleaning up temp files"
  file: 
    path: "{{ tmp_dir.path }}"
    state: absent

# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool