---
- environment:
    OS_AUTH_URL: "{{ osp_auth_url }}"
    OS_USERNAME: "{{ osp_auth_username }}"
    OS_PASSWORD: "{{ osp_auth_password }}"
    OS_PROJECT_NAME: "{{ osp_project_name }}"
    OS_PROJECT_DOMAIN_ID: "{{ osp_auth_project_domain }}"
    OS_USER_DOMAIN_NAME: "{{ osp_auth_user_domain }}"
  block:
    - name: Delete Heat stack
      #command: openstack stack delete -y {{ guid }}-base-stack
      os_stack:
        name: "{{ guid }}-base-stack"
        state: absent
        wait: true
      retries: "{{ osp_stack_delete_retries }}"
      delay: 10
      until: r_hot_out is succeeded
      register: r_hot_out

    - debug:
        var: r_hot_out
