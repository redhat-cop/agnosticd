---
- when: firewalld_active | bool
  name: Open up firewall port(s)
  firewalld:
    port: "{{ port }}/tcp"
    permanent: yes
    state: enabled
    immediate: true
  loop: "{{ a_simple_webserver_ports }}"  
  loop_control:
    loop_var: port
  tags:
    - security

- name: Install webserver package(s)
  package:
    name: "{{ __package }}"
    state: present
  loop: 
    - "{{ a_simple_webserver_packages }}"
  loop_control:
    loop_var: __package
  notify:
    - Start_webserver

- name: Copy in webpage
  copy:
    src: index.html
    dest: "{{ a_simple_webserver_home }}"
  notify:
    - Reload_webserver

- name: Smoketest webserver locally from itself
  uri:
    url: "http://localhost:{{ a_simple_webserver_ports[0] }}"
    return_content: yes
  register: r_webserver_result
  until: '"AgnosticD" in r_webserver_result.content'
  retries: 10
  delay: 1
  tags:
    - smoketest
...
