- name: Add tower inventory
  tower_inventory:
    name: "{{ item.name }}"
    description: "{{ item.description  }}"
    organization: "{{ item.organization | d('gpte') }}"
    state: present
    tower_host: "tower1.{{target_regions[0].name}}.{{guid}}{{subdomain_base_suffix}}"  
    tower_username: admin
    tower_password: "{{tower_admin_password}}"
    tower_verify_ssl: false
  loop: "{{ tower_inventories }}"
  tags:
    - tower-inventory-create


- name: Associate instance group to inventory 
  command: >- 
    tower-cli inventory 
    associate_ig 
    --inventory "{{ item.name }}"
    --instance-group "{{ item.instance_group | d('') }}"
  loop: "{{ tower_inventories }}"
  when: 
     - item.instance_group is defined