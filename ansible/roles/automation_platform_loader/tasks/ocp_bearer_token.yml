---

- name: Login to OpenShift
  ansible.builtin.command: >
    oc login --username {{ openshift_admin_user }}
    --password {{ openshift_kubeadmin_password }}
    {{ openshift_api_url }}

- name: Get OCP bearer token
  ansible.builtin.command: oc whoami -t
  register: r_oc_whoami

- name: Create OCP bearer token as fact
  ansible.builtin.set_fact:
    openshift_bearer_token: "{{ r_oc_whoami.stdout }}"

- name: Set agnosticd_user_info ssh data
  agnosticd_user_info:
    data:
      openshift_bearer_token: "{{ openshift_bearer_token }}"
