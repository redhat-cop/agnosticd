---
- name: Listing repository
  shell:  'hammer --output json  repository list --organization "{{ORG}}" |grep Id'
  register: repo_list
  tags: 
    - satellite_configuration
    - content-view

- name: Print repo IDs
  debug: 
    msg: "{{ item.split(':')[1].split(',')[0] }}"
  loop: "{{repo_list.stdout_lines}}"
  tags: 
    - satellite_configuration
    - content-view

- name: Create Content-view
  shell: hammer content-view create --name "{{CONTENT_VIEW_NAME}}"  --organization "{{ORG}}"
  tags:
    - satellite_configuration
    - content-view

- name: adding repo to content-view
  shell: hammer content-view add-repository
      --organization "{{ORG}}"
      --name "{{CONTENT_VIEW_NAME}}"
      --repository-id  "{{ item.split(':')[1].split(',')[0] }}"
  loop: "{{repo_list.stdout_lines}}"
  tags: 
    - satellite_configuration
    - content-view

- name: Publishing content-view
  shell: hammer content-view publish
      --organization "{{ORG}}"
      --name "{{CONTENT_VIEW_NAME}}"
      --async
  tags: 
    - satellite_configuration
    - content-view