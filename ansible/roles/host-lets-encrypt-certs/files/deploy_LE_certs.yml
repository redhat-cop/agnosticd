---
# This playbook redeploys Lets Encrypt certificates for master API and apps (router)
# It does not renew the certs, which is done by the acme.sh cronjob.
#
# Please ensure CA and key have not changed.

- hosts: masters
  gather_facts: false
  become: true
  any_errors_fatal: true
  handlers:
    - name: restart master API
      service:
        name: atomic-openshift-master-api
        state: restarted
  tasks:
    - name: Copy certs and CA to master
      copy:
        src: "{{ acme_install_dir }}/fullchain.cer"
        dest: "/etc/origin/master/named_certificates/{{openshift_master_cluster_hostname}}.cer"
        backup: true
      notify: restart master API

- import_playbook: /usr/share/ansible/openshift-ansible/playbooks/openshift-hosted/redeploy-router-certificates.yml
