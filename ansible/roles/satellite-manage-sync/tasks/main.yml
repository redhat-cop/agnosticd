---

- name: Grab ID of existing repos
  shell: >-
    hammer repository list
    --organization "{{ org }}" | grep yum | awk '{print $1}'
  register: repos

# - debug: var=repos

- name: Sync repo
  command: >-
    hammer repository synchronize
    --organization "{{ org }}"
    --id "{{ item }}"
  loop: "{{ repos.stdout_lines }}"
  # register: sync_result
  # retries: 3
  # until: "{{ sync_result is  success }} "
  async: 50
  tags:
    - configure_satellite
    - configure_satellite_repository
    - configure_satellite_sync_repo



