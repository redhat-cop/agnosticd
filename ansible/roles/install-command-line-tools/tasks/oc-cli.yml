- name: Set URL for OpenShift GA release
  ansible.builtin.set_fact:
    ocp4_client_url: >-
      {{ '{0}/ocp/latest/openshift-client-linux.tar.gz'.format(
        ocp4_installer_root_url | default("https://mirror.openshift.com/pub/openshift-v4/clients")
      ) }}

- name: Ensure ocp4_client_url is set
  ansible.builtin.assert:
    that: ocp4_client_url | default('') | length > 0

- name: Install OpenShift CLI
  become: true
  ansible.builtin.unarchive:
    src: "{{ ocp4_client_url }}"
    remote_src: true
    dest: /usr/bin
    mode: 0775
    owner: root
    group: root
  retries: 10
  register: r_client
  until: r_client is success
  delay: 30

- name: Create OpenShift Bash completion file
  become: true
  ansible.builtin.shell: /usr/bin/oc completion bash >/etc/bash_completion.d/openshift