- name: Copy Tower License File
  copy:
    content: "{{ tower_license | from_json }}"
    dest: /root/license.txt
  tags:
      - tower-license-injector

- name: Install tower-cli
  pip:
    name: ansible-tower-cli
    state: latest
  tags:
      - tower-license-injector

- name: Configure the tower cli file
  template:
    src: "tower_cli.j2"
    dest: "/root/.tower_cli.cfg"
    mode: 0600
  tags:
      - tower-license-injector

- name: Add the tower license
  command: tower-cli setting modify LICENSE @/root/license.txt --insecure
  tags:
      - tower-license-injector