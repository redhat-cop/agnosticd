---

- name: Create user {{ rhel_zero_touch_user_name }}
  ansible.builtin.user:
    name: "{{ rhel_zero_touch_user_name }}"
    group: "{{ rhel_zero_touch_user_private_group }}"
    append: "{{ rhel_zero_touch_user_groups_append | default(true) }}"
    groups: "{{ rhel_zero_touch_user_groups | default(omit) }}"
    update_password: "{{ rhel_zero_touch_user_password_update | default(omit) }}"
    state: present

- name: Set ssh user {{ rhel_zero_touch_user_name }} password
  when: rhel_zero_touch_user_password is defined
  ansible.builtin.user:
    name: "{{ rhel_zero_touch_user_name }}"
    password: "{{ rhel_zero_touch_user_password | password_hash('sha512') | default(omit) }}"
    update_password: always
