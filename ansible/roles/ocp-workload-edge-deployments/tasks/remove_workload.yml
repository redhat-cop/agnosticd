---
# Implement your Workload removal tasks here
- name: Cleaning up the environment
  debug:
    msg: "Cleaning up the environment.."

- name: Delete project IoT Development
  shell: "oc delete project iot-development"
  ignore_errors: true

- name: Delete project IoT Testing
  shell: "oc delete project iot-testing"
  ignore_errors: true

- name: Delete project IoT Hub
  shell: "oc delete project iot-hub"
  ignore_errors: true

- name: Delete BuildConfig in openshift namespace
  shell: "oc delete bc deploy-containers-apb -n openshift"
  ignore_errors: true

- name: Delete ImageStream in openshift namespace
  shell: "oc delete is deploy-containers-apb -n openshift"
  ignore_errors: true

- name: Cleaning up temp dir
  shell: "rm -rf /tmp/{{guid}}"
  ignore_errors: true

- name: Restoring up /etc/containers/registries.conf
  become: true
  shell: mv /etc/containers/registries.conf.bak /etc/containers/registries.conf
  ignore_errors: true

- name: Removing Cockpit and Docker (it will be replaced by Podman as soon as Cockpit-Podman will become stable)
  become: true
  ignore_errors: true
  yum:
    name: ['docker', 'cockpit', 'cockpit-docker', 'apb']
    state: absent

# Leave this as the last task in the playbook.
- name: remove_workload tasks complete
  debug:
    msg: "Remove Workload tasks completed successfully."
  when: not silent|bool
