# vim: set ft=ansible
---
# Implement your Workload deployment tasks here

- name: create istio-bookinfo project
  k8s:
    state: present
    definition:
      apiVersion: project.openshift.io/v1
      kind: Project
      metadata:
        name: istio-bookinfo


# jaeger is the last thing to come up because it depends on ES working
- name: wait up to 11 minutes for jaeger-collector to be healthy
  shell: "oc get deployment -n istio-system jaeger-collector -o jsonpath='{.status.readyReplicas}'"
  register: jaeger_collector_ready
  until: "jaeger_collector_ready.stdout | int == 1"
  retries: 11
  delay: 60

# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool

