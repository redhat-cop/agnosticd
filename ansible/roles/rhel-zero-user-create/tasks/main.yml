---

- name: Create user skel files
  when: rhel_zero_users_create_enable_skel | default(true) | bool
  ansible.builtin.copy:
    src: "{{ __file }}"
    dest: "/etc/skel/"
  loop: "{{ rhel_zero_users_create_skel_files }}"
  loop_control:
    loop_var: __file

- name: Create user {{ rhel_zero_users_create_name }}
  ansible.builtin.include_tasks: create-user.yml

- name: Setup user's resource directory
  ansible.builtin.include_tasks: create-directory.yml

- name: Enable sudoers
  when: rhel_zero_users_create_enable_sudoers | default(true) | bool
  ansible.builtin.copy:
    content: >
      {{ rhel_zero_users_create_name }}
      ALL=(ALL) {{ rhel_zero_users_create_sudo_commands | default('NOPASSWD: ALL') }}
    dest: '/etc/sudoers.d/{{ rhel_zero_users_create_name }}'
    mode: "u=rw,o=r,g=r"

- name: ssh setup for user
  ansible.builtin.include_tasks: ssh-config.yml

- name: Copy files
  ansible.builtin.include_tasks: copy-files.yml

- name: Copy templates
  ansible.builtin.include_tasks: copy-templates.yml

- name: Copy contents
  ansible.builtin.include_tasks: copy-contents.yml

# - name: "Ensure prefered python {{ rhel_zero_users_create_preferred_python }} installed and configured"
#   when: config_user_preferred_python | default(true) | bool
#   block:
#
#     - name: Install preferred python
#       ansible.builtin.package:
#         name: "python{{ rhel_zero_users_create_preferred_python }}"
#         state: present
#
#     - name: "Ensure Python {{ rhel_zero_users_create_preferred_python }} default python3"
#       community.general.alternatives:
#         name: python
#         link: /usr/bin/python3
#         path: "/usr/bin/python{{ rhel_zero_users_create_preferred_python }}"
#
#     - name: "Ensure Python {{ rhel_zero_users_create_preferred_python }} default python"
#       community.general.alternatives:
#         name: python
#         link: /usr/bin/python
#         path: "/usr/bin/python{{ rhel_zero_users_create_preferred_python }}"

# TODO: once community.general 4.8.0 in common user
# add `state: selected` to clean this up
