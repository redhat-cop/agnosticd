---

- name: Extract eks cluster kubeconfig
  environment:
    aws_access_key_id: "{{ hostvars.localhost.admin_access_key_id }}"
    aws_secret_access_key: "{{ hostvars.localhost.admin_secret_access_key }}"
    AWS_DEFAULT_REGION: "{{ aws_region }}"
  ansible.builtin.shell:
    cmd: >-
      aws eks update-kubeconfig
      --name {{ deploy_eks_cluster_name }}
      --profile eks
      --role-arn arn:aws:iam::{{ sandbox_account_id }}:role/eks-admin
      --alias eks-admin
      --kubeconfig /home/{{ deploy_eks_cluster_extract_kubeconfig_username }}/.kube/config
