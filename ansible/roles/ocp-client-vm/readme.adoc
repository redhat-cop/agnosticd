= ocp-client-vm

== Playbook
. At root of $ANSIBLE_REPO_PATH, Create an ansible inventory file with hosts in the following group: `bastions`

. Execute:
+
-----
WORKLOAD="ocp-client-vm"

NON_ROOT_LOGIN_USER="rhel7"
DOCKER_VERSION=1.13.1

ansible-playbook -i hosts ./configs/rhte-oc-cluster-vms/software.yml \
                    -e"ANSIBLE_REPO_PATH=`pwd`" \
                    -e"ocp_workload=${WORKLOAD}" \
                    -e"non_root_os_user=${NON_ROOT_LOGIN_USER}" \
                    -e "docker_version=${DOCKER_VERSION}"

subdomain_base=192.168.122.235.nip.io
ansible_hostname=apimesh
osrelease=3.9
student_workloads=ocp-workload-istio-community,ocp-workload-rhte-mw-api-mesh
ansible-playbook -i hosts ./configs/rhte-oc-cluster-vms/post_software.yml \
                    -e"ANSIBLE_REPO_PATH=`pwd`" \
                    -e"ocp_workload=${WORKLOAD}" \
                    -e"ansible_hostname=${ansible_hostname}" \
                    -e"subdomain_base=${subdomain_base}" \
                    -e"osrelease=${osrelease}" \
                    -e"student_workloads=${student_workloads}"
-----

== Appendix: Local VM Set-up

=== Base RHEL7 VM
. Create a base RHEL7 minimal VM called: base/rhel7_base_sparse.qcow2
. Ensure the following repos are enabled:
+
-----
subscription-manager repos \
    --enable="rhel-7-server-rpms" \
    --enable="rhel-7-server-extras-rpms" \
    --enable="rhel-7-server-supplementary-rpms" \
    --enable="rhel-7-server-optional-rpms" \
    --enable="rhel-atomic-7-cdk-3.5-rpms" \
    --enable="rhel-atomic-host-rpms" \
    --enable="rhel-7-server-ose-3.9-rpms"
-----

. Ensure the following two non-root OS users:groups already exist on the target VM:
.. *lab-user:100*
.. *${NON_ROOT_LOGIN_USER}:${NON_ROOT_LOGIN_USER}*

. Ensure the following ports are enabled through the firewall:
+
-----
$ firewall-cmd --permanent --zone public --add-port 8443/tcp
$ firewall-cmd --permanent --zone public --add-port 53/udp
$ firewall-cmd --permanent --zone public --add-port 8053/udp
$ firewall-cmd --reload
-----

=== Target VM

-----
$ cp base/rhel7_base_sparse.qcow2 rhte/rhte_lab_04_api_mgmt_and_service_mesh.qcow2

$ virt-install --import -n rhte_lab_04_api_mgmt_and_service_mesh -r 8192 --vcpus=2 --disk rhte/rhte_lab_04_api_mgmt_and_service_mesh.qcow2,format=qcow2,bus=virtio
-----



