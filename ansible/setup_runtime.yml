---
- name: Step 0000 - Setup output_dir
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tasks:
    - debug:
        msg: "Warning: ANSIBLE_REPO_PATH variable is deprecated, you don't have to use it anymore."
      when: ANSIBLE_REPO_PATH is defined

    - name: Set output_dir if not defined
      set_fact:
        output_dir: >-
          {{
          ANSIBLE_REPO_PATH + '/workdir' if ANSIBLE_REPO_PATH is defined
          else '/tmp/output_dir'
          }}

      when: output_dir is not defined

    - name: Stat output_dir
      stat:
        path: "{{ output_dir }}"
      register: rstat_output_dir

    - name: stat pre-reqs
      stat:
        path: "./configs/{{ env_type }}/pre-reqs.yml"
      register:
        prer_output

    - name: Create output_dir if it does not exists
      file:
        path: "{{ output_dir }}"
        state: directory
      when: not rstat_output_dir.stat.exists

# include global vars from the config
- import_playbook: include_vars.yml

# Load galaxy roles of the config
- import_playbook: install_galaxy_roles.yml
  tags: galaxy_roles

# include pre-reqs if it exists under config/configname
- import_playbook: ./configs/{{ env_type }}/pre_reqs.yml
  when: prer_output.stat.exists