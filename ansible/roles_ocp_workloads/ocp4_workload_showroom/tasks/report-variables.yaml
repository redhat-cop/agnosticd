- name: Get the Showroom route
  kubernetes.core.k8s_info:
    api_version: route.openshift.io/v1
    kind: Route
    name: "showroom-proxy"
    namespace: "{{ _showroom_namespace }}"
  register: r_showroom_route
  failed_when: r_showroom_route.resources | default([]) | length != 1
  until: r_showroom_route is successful
  retries: 10
  delay: 5

- name: Output agnosticd_user_info for showroom
  ansible.builtin.debug:
    msg:
      - "Lab instructions: {{ _showroom_url }}"
      - "showroom_url: {{ _showroom_url }}"
  vars:
    _route: "{{ r_showroom_route.resources[0] }}"
    _showroom_url: "https://{{ _route.spec.host }}/"

- name: Output agnosticd_user_info for showroom
  agnosticd_user_info:
    msg: "Lab instructions: {{ _showroom_url }}"
    data:
      showroom_url: "{{ _showroom_url }}"
      showroom_primary_view_url: "{{ _showroom_url }}/"
  vars:
    _route: "{{ r_showroom_route.resources[0] }}"
    _showroom_url: "https://{{ _route.spec.host }}/"

- name: Save code server information for each user
  agnosticd_user_info:
    user: "{{ ocp4_workload_codeserver_multi_user_username_base }}{{ n }}"
    data:
      codeserver_url: >-
        https://{{ ocp4_workload_codeserver_name }}-{{ ocp4_workload_codeserver_multi_user_namespace_base }}-{{
        ocp4_workload_codeserver_multi_user_username_base }}{{ n }}.{{ _ocp4_workload_codeserver_wildcard_domain }}
      codeserver_password: "{{ ocp4_workload_codeserver_password }}"
  loop: "{{ range(1, 1 + ocp4_workload_codeserver_multi_user_num_users | int) | list }}"
  loop_control:
    loop_var: n
    label: "{{ ocp4_workload_codeserver_multi_user_username_base }}{{ n }}"
