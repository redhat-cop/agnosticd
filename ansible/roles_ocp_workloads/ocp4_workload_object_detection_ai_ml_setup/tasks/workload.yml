---
- name: Setting up workload for user
  debug:
    msg: "Setting up workload for user ocp_username = {{ ocp_username }}"

- name: Set up RHODS Object Detection project and workload
  k8s:
    state: present
    definition: "{{ lookup('template',  item ) | from_yaml }}"
  loop:
  - prod_namespace.yaml.j2
  - pvc-workspace.yaml
  - object-detection-app-git-buildconfig.yaml
  - object-detection-app-git-imagestream.yaml
  - object-detection-app-git-deployment.yaml
  - object-detection-app-git-route.yaml
  - object-detection-app-git-service.yaml
  - object-detection-rest-buildconfig.yaml
  - object-detection-rest-imagestream.yaml
  - object-detection-rest-deployment.yaml
  - object-detection-rest-route.yaml
  - object-detection-rest-service.yaml
  - object-detection-rest-pipeline.yaml
  - object-detection-rest-pipeline-run.yaml

#- name: Print student information
#  agnosticd_user_info:
#    msg: "{{ item }}"
#  loop:
#  - "GUID (Project Prefix): {{ guid }}"
#  - "Gitea repository:"
#  # yamllint disable rule:line-length
#  - "- URL: {{ ocp4_workload_adv_app_deploy_ilt_final_lab_gitea_url }}/{{ ocp4_workload_adv_app_deploy_ilt_final_lab_gitea_user }}/{{ ocp4_workload_adv_app_deploy_ilt_final_lab_gitea_repo_name }}"
#  - "- Username: {{ ocp4_workload_adv_app_deploy_ilt_final_lab_gitea_user }}"
#  - "- Password: {{ _ocp4_workload_adv_app_deploy_ilt_final_lab_gitea_password }}"
#  - "Argo CD:"
#  - "- Username: admin"
#  - "- Password: {{ ocp4_workload_adv_app_deploy_ilt_final_lab_argocd_password }}"
#  - "The following projects have been set up:"
#  - "- {{ guid }}-dev-coffeeshop"
#  - "- {{ guid }}-prod-coffeeshop"
#  - "- {{ guid }}-pipeline"
#  - "- {{ guid }}-argocd"

# Leave this as the last task in the playbook.
# --------------------------------------------
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent | bool
