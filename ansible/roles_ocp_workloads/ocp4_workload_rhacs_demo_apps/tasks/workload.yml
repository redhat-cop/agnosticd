---
# Implement your Workload deployment tasks here

- name: Setting up workload for user
  debug:
    msg: "Setting up workload for user ocp_username = {{ ocp_username }}"

- name: Set paths
  set_fact:
    __repo_path: "$HOME/rhacs_demo/"
    __repo_url: 'https://github.com/redhat-gpte-devopsautomation/rhacs_demo'

- name: Create repo dir
  ansible.builtin.file:
    path: "{{ __repo_path }}"
    state: directory
    mode: '0755'

- name: Checkout sample app repo
  ansible.builtin.git:
    repo: "{{ __repo_url }}"
    dest: "{{ __repo_path }}"
    version: "main"

- name: Execute Kustomize to pull in all the demo resources
  shell:
    cmd: "oc apply -f {{ __repo_path }}/{{ item }}"
  loop:
    - "configuration"
    - "apps/frontend"
    - "apps/log4shell"
    - "apps/medical"
    - "apps/operations"
    - "apps/payments"
    - "apps/spring4shell"
    - "apps/yelb"
    - "apps/backend"
    - "pipelines/tasks"
    - "pipelines/pipeline"

# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool
