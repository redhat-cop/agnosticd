---
# Implement your workload removal tasks here
# ------------------------------------------

# Remove Defenders
- name: Remove Defender daemonset YAML
  command: 'oc delete -f ~{{ansible_user}}/twistlock/defender-ds.yaml'

- name: Remove the console to the cluster
  command: >-
    oc delete -f ~{{ansible_user}}/twistlock/twistlock_console.yaml

#- name: Remove OpenShift Objects for Prisma Cloud
#  k8s:
#   state: absent
#    definition: "{{ lookup('template', item ) | from_yaml }}"
#  loop:
#    - project.j2
#    - pvc.j2

- name: Remove the Prisma Cloud installation
  become: true
  file:
    state: absent
    path: "{{ item }}"
  loop:
  - ~{{ansible_user}}/twistlock


# Leave this as the last task in the playbook.
# --------------------------------------------
- name: remove_workload tasks complete
  debug:
    msg: "Prisma Cloud Remove Workload tasks completed successfully."
  when: not silent|bool
