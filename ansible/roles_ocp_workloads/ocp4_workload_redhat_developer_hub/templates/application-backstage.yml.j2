apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: backstage
  namespace: openshift-gitops
spec:
  destination:
    namespace: {{ ocp4_workload_redhat_developer_hub_backstage_namespace }}
    server: 'https://kubernetes.default.svc'
  project: default
  source:
    helm:
      parameters:
        - name: app.baseUrl
          value: https://{{ ocp4_workload_redhat_developer_hub_backstage_host }}
        - name: argocd.appLocatorMethods[0].instances[0].name
          value: main
        - name: argocd.appLocatorMethods[0].instances[0].password
          value: {{ ocp4_workload_redhat_developer_hub_argocd_password }}
        - name: argocd.appLocatorMethods[0].instances[0].url
          value: https://{{ ocp4_workload_redhat_developer_hub_argocd_host }}
        - name: argocd.appLocatorMethods[0].instances[0].username
          value: admin
        - name: argocd.appLocatorMethods[0].type
          value: config
        - name: backend.baseUrl
          value: https://{{ ocp4_workload_redhat_developer_hub_backstage_host }}
        - name: backend.cors.origin
          value: https://{{ ocp4_workload_redhat_developer_hub_backstage_host }}
        - name: backend.reading.allow[0].host
          value: "*.{{ ocp4_workload_redhat_developer_hub_apps_domain }}"
        - name: catalog.locations[0].rules[0].allow[0]
          value: Template
        - name: catalog.locations[0].target
          value: https://{{ ocp4_workload_redhat_developer_hub_gitlab_host }}/{{ ocp4_workload_redhat_developer_hub_backstage_gitlab_group }}/software-templates/blob/main/showcase-templates.yaml
        - name: catalog.locations[0].type
          value: url
        - name: catalog.providers.gitlab.selfHosted.host
          value: {{ ocp4_workload_redhat_developer_hub_gitlab_host }}
        - name: image
          value: quay.io/redhat-gpte/backstage:1.0.0
        - name: integrations.gitlab[0].apiBaseUrl
          value: https://{{ ocp4_workload_redhat_developer_hub_gitlab_host }}/api/v4
        - name: integrations.gitlab[0].baseUrl
          value: https://{{ ocp4_workload_redhat_developer_hub_gitlab_host }}
        - name: integrations.gitlab[0].host
          value: {{ ocp4_workload_redhat_developer_hub_gitlab_host }}
        - name: integrations.gitlab[0].token
          value: {{ ocp4_workload_redhat_developer_hub_gitlab_root_token }}
        - name: keycloak.baseUrl
          value: https://{{ ocp4_workload_redhat_developer_hub_keycloak_host }}/auth
        - name: keycloak.clientId
          value: {{ ocp4_workload_redhat_developer_hub_backstage_client_id }}
        - name: keycloak.clientSecret
          value: {{ ocp4_workload_redhat_developer_hub_backstage_client_secret }}
        - name: keycloak.loginRealm
          value: {{ ocp4_workload_redhat_developer_hub_backstage_client_id }}
        - name: keycloak.realm
          value: {{ ocp4_workload_redhat_developer_hub_backstage_client_id }}
        - name: oauth2Proxy.cookieSecret
          value: {{ lookup('password', '/dev/null chars=ascii_lowercase length=32') }}
        - name: oauth2Proxy.issuerUrl
          value: https://{{ ocp4_workload_redhat_developer_hub_keycloak_host }}/auth/realms/backstage
        - name: oauth2Proxy.skipTlsVerify
          value: "true"
        - name: postgresql.password
          value: {{ ocp4_workload_redhat_developer_hub_postgresql_password }}
        - name: clusters[0].name
          value: dev-cluster-infra
        - name: clusters[0].url
          value: {{ ocp4_workload_redhat_developer_hub_ocp_api }}
        - name: clusters[0].serviceAccountToken
          value: {{ ocp4_workload_redhat_developer_hub_ocp_default_sa_token }}
clusters:
  - name: dev-cluster-infra
    url: https://api.cluster-s5htd.sandbox1683.opentlc.com:6443
    serviceAccountToken: "eyJhbGciOiJSUzI1NiIsImtpZCI6Iks5OXFnSExncndoTUZfaThucWpwalZTdll3Q1JZUlNiUUZ4YXNRS0NzWEUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJiYWNrc3RhZ2UiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoiYmFja3N0YWdlLXRva2VuLTIyN3RnIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImJhY2tzdGFnZSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjE0NGZhNDhhLWEzM2MtNDAzOS05YzFhLWM3YTdjNWQ4NzFkNiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpiYWNrc3RhZ2U6YmFja3N0YWdlIn0.gQZ4zm3a11qybKowLZxDu8ljwj1S5_OGdfZBjr-Px99UXcAcaE5llzPxJ30WtxbmAjmwjxRhy7qbjbRl3oPxKIiOMPjkFk1ON5u1tSdhKt9Z4zZBJHSOYCoxLTp4dgNp_vlps55-eiIfu7vnA42q2rMjqabkkICN8BSXM2AgY2fKQspvKlv7E_hBeL3Ck1oPY1yyoPrjBdMSoP9x79E_wAlmduguFX8R3UPukMeQsfwoXJ-kzBFLFK87e220lDeW4AJqKlJBEj7wPfBTmeOiwaoEfmfkMgw9QxcKfLXJwsgffgCoSJG8kyonUwHQpc5TDheDeR2OxDJIl-zjWHvUDOPykpslxGMVFLdqU-o6TYX1LTm5OV4EgZ965J3wKWnuCGHFFjCgRfRPBCYmbohSKZ4nDqL6IHbIeq17r3jd9tSI_krZHvV1q54L2DU9DrGCLwjfaOKIvI0hVmMUVzdEs0EK8puKZO46fs1MQpI5n-BZqIfT1TTkudP1ya6QynTRJ4tPFwIqut4R0ECPwt76jhjOPJ9bHCKVJUhASeiF3HhbCiH5SRLd3sgsLZFjQHvQjteU8HvskJMnO0Bw7C68YbtMUEZqWLcqs91wjJvZxlZuzk-4GR-w74gsBfxZQqSa9sBmQWscelrOdegmzaKDfp2faPJK50TXbomaQ3oxp_Y"

    path: charts/backstage
    repoURL: {{ ocp4_workload_redhat_developer_hub_backstage_gitops_repo }}
    targetRevision: HEAD
  syncPolicy:
    automated: {}
    syncOptions:
      - CreateNamespace=true