---
- set_fact:
    cluster_name: "{{ item.managed_cluster_name }}"
    aws_cluster_region: "{{ item.managed_cluster_region }}"
    label_environment_type: "{{ item.managed_cluster_label }}"
    _ocp4_workload_rhacm_clusters_master_instance_type: "{{ item.managed_cluster_master_instance_type | default() }}"
    _ocp4_workload_rhacm_clusters_master_replica_count: "{{ item.managed_cluster_master_replica_count | default() }}"
    _ocp4_workload_rhacm_clusters_worker_instance_type: "{{ item.managed_cluster_worker_instance_type | default() }}"
    _ocp4_workload_rhacm_clusters_worker_replica_count: "{{ item.managed_cluster_worker_replica_count | default() }}"

- name: Create OpenShift objects for workload
  k8s:
    state: present
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - ./templates/namespace.j2
    - ./templates/secret_auth_token.j2
    - ./templates/aws/secret_aws_creds.j2
    - ./templates/aws/secret_install_config_aws.yaml.j2
    - ./templates/secret_ssh_privatekey.j2
    - ./templates/klusterletaddonconfig.j2
    - ./templates/aws/machinepool_aws.yaml.j2
    - ./templates/aws/managedcluster_aws.yaml.j2
    - ./templates/aws/clusterdeployment_aws.yaml.j2
