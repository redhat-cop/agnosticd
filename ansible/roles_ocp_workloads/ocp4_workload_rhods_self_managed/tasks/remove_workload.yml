---
#Implement your Workload deployment tasks here
- name: Find all KfDef instances
  kubernetes.core.k8s:
    state: absent
    api_version: kfdef.apps.kubeflow.org/v1
    kind: KfDef
    name: "{{ item.name }}"
    namespace: "{{ item.namespace }}"
  loop:
  - { "name": "opendatahub", "namespace": "redhat-ods-applications"}
  - { "name": "monitoring", "namespace": "redhat-ods-monitoring"}
  - { "name": "monitoring", "namespace": "redhat-ods-operator"}
  - { "name": "monitoring", "namespace": "rhods-notebooks"}

- name: Remove RHODS Self Managed Operator
  include_role:
    name: install_operator
  vars:
    install_operator_action: remove
    install_operator_name: "{{ ocp4_workload_rhods_self_managed_operator_name }}"
    install_operator_namespace: "{{ ocp4_workload_rhods_self_managed_namespace }}"
    install_operator_channel: "{{ ocp4_workload_rhods_self_managed_channel }}"
    install_operator_catalog: "{{ ocp4_workload_rhods_self_managed_catalogsource_name }}"
    install_operator_packagemanifest_name: "{{ ocp4_workload_rhods_self_managed_install_operator_name }}"
    install_operator_automatic_install_plan_approval: "{{ ocp4_workload_rhods_self_managed_installPlanApproval }}"
    install_operator_csv_nameprefix: "{{ ocp4_workload_rhods_self_managed_csv_nameprefix }}"
    install_operator_starting_csv: "{{ ocp4_workload_rhods_self_managed_startingCSV }}"
    install_operator_catalogsource_setup: "{{ ocp4_workload_rhods_self_managed_catalogsource_setup }}"
    install_operator_catalogsource_name: ""
    install_operator_catalogsource_namespace: ""
    install_operator_catalogsource_image: ""
    install_operator_catalogsource_image_tag: ""
    install_operator_catalogsource_pullsecrets:
    - ""
- name: Remove RHODS Operator Group 
  kubernetes.core.k8s:
    state: absent
    definition: "{{ lookup('template', './templates/redhat-ods-operator.yaml.j2' ) | from_yaml  }}"

# Delete Projects
- name: Delete the projects
  kubernetes.core.k8s:
    state: absent
    kind: Namespace
    name: "{{ item }}"
  loop: "{{ ocp4_workload_rhods_self_managed_namespace_list }}"
