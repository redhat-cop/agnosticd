---

- name: Create postgres secret
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - PostgresSecret.j2

- name: Create objects for Postgres from Deployment Config
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - PostgresDeploymentConfig.j2
  register: r_starburst

- name: Get Postgresql Service
  kubernetes.core.k8s_info:
    kind: Service
    namespace: default
    name: postgresql
  register: postgresql_service

- debug:
    msg: "{{ postgresql_service }}"
  
- name: Set the Postgresql IP and Port
  set_fact:
    postgresql_service_ip: "{{ postgresql_service.resources[0].spec.clusterIP }}"
    postgresql_service_port: "{{ postgresql_service.resources[0].spec.ports[0].port }}"

- debug:
    msg: "{{ postgresql_service_ip }}"

- name: Create objects for Starburst Enterprise - secrets
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - StarburstSecret.j2

- name: Create objects for Starburst Enterprise - subsrcription
  kubernetes.core.k8s:
    state: present 
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - StarburstSubscription.j2
  register: r_starburst

- name: Create objects for Starburst Enterprise - StarburstEnterprise
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - StarburstEnterprise.j2

- name: Create objects for Starburst Enterprise - StarburstHive
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', item ) | from_yaml }}"
  loop:
    - StarburstHive.j2
 
- name: workload Tasks Complete
  debug:
    msg: workload Tasks Complete