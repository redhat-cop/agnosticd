---
- name: Setting up workload for Retail ML Object Detection Use Case
  debug:
    msg: "Setting up workload for Retail ML Object Detection Use Case"

- name: Set up Gitops environment
  when: ocp4_workload_aiml_demo_gitops_setup | bool
  ansible.builtin.include_tasks: setup-gitops.yml

- name: Set up RHODS Object Detection dev project using OpenShift Pipeline and OpenShift GitOps
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template',  item ) | from_yaml }}"
  loop:
  - retail-kustomize/dev_namespace.yaml.j2
  - retail-kustomize/gitea-dev-secret.yaml.j2
  - retail-kustomize/retail-app.yaml.j2

- name: Create secret in dev
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'retail-kustomize/cluster-config-secret.yaml.j2' ) }}"

- name: Set up RHODS Object Detection PROD project  - argocd
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template',  item ) | from_yaml }}"
  loop:
  - retail-prod-kustomize/prod_namespace.yaml.j2
  - retail-prod-kustomize/gitea-prod-secret.yaml.j2
  - retail-prod-kustomize/retail-prod-app.yaml.j2

- name: Create secret in prod
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'retail-prod-kustomize/cluster-config-secret.yaml.j2' ) }}"

- name: Set up RHODS Object Detection dev project using OpenShift Pipeline and OpenShift GitOps
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template',  item ) | from_yaml }}"
  loop:
  - web-terminal-subscription.yaml.j2

# Leave this as the last task in the playbook.
# --------------------------------------------
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent | bool
