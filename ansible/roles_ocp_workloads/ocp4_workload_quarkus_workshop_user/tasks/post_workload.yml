---
- name: Verify everything is deployed correctly
  include_tasks: verify-workload.yaml

# Implement your Post Workload deployment tasks here

- name: Print user info
  agnosticd_user_info:
    msg: "{{ item }}"
  loop:
  - "{{ ocp_username }} has been setup on the shared lab environment."
  - "You have access to the following project: quarkus-{{ guid }}-project"
  - ""
  - "OpenShift Console: https://{{ r_console_route.resources[0].spec.host }}"
  - "CodeReady Console: https://codeready-codeready.{{ route_subdomain }}"
  - ""

- name: Print module info
  agnosticd_user_info:
    msg: "Module {{ocp4_workshop_quarkus_workshop_user_module_titles[item].title}} for {{ocp_username}}: http://web-{{item}}-quarkus-{{guid}}-guides.{{ route_subdomain }}{{ocp4_workshop_quarkus_workshop_user_module_titles[item].path}}?userid={{ocp_username | urlencode }}&guid={{guid | urlencode }}"
  loop: "{{ modules }}"

- name: Save user data
  agnosticd_user_info:
    data:
      web_console_url: "https://{{ r_console_route.resources[0].spec.host }}"
      api_url: "{{ r_console_route.resources[0].spec.host }}"
      login_command: "oc login -u {{ ocp_username }} {{ r_api_url.resources[0].status.apiServerURL }}"

# Leave this as the last task in the playbook.
- name: post_workload tasks complete
  debug:
    msg: "Post-Workload Tasks completed successfully."
  when: not silent|bool
