---
apiVersion: app.k8s.io/v1beta1
kind: Application
metadata:
  name: hello-microshift
  namespace: {{ ocp4_workload_microshift_cluster_namespace }}
spec:
  componentKinds:
  - group: apps.open-cluster-management.io
    kind: Subscription
  descriptor: {}
  selector:
    matchExpressions:
      - key: app
        operator: In
        values: 
          - hello-microshift
---
apiVersion: apps.open-cluster-management.io/v1
kind: Channel
metadata:
  annotations:
    apps.open-cluster-management.io/reconcile-rate: medium
  name: microshift
  namespace: {{ ocp4_workload_microshift_cluster_namespace }}
spec:
  type: HelmRepo
  pathname: {{ ocp4_workload_microshift_app_repo }}
---
apiVersion: apps.open-cluster-management.io/v1
kind: Subscription
metadata:
  labels:
    app: hello-microshift
  name: hello-microshift
  namespace: {{ ocp4_workload_microshift_cluster_namespace }}
spec:
  channel: {{ ocp4_workload_microshift_cluster_namespace }}/microshift
  name: hello-microshift
  packageOverrides:
  - packageName: hello-microshift
    packageAlias: hello-microshift
    packageOverrides:
    - path: spec
      value:
        namespace: {{ ocp4_workload_microshift_app_namespace }}
        image: {{ ocp4_workload_microshift_app_image }}
        host: ingress-{{ ocp4_workload_microshift_namespace }}.{{ _ocp4_workload_microshift_wildcard_domain }}
  placement:
    placementRef:
      kind: PlacementRule
      name: hello-microshift
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  labels:
    app: hello-microshift
  name: hello-microshift
  namespace: {{ ocp4_workload_microshift_cluster_namespace }}
spec:
  clusterSelector:
    matchLabels:
      'type': 'MicroShift'
