---
- name: virtualenv path to use for pip
  set_fact:
    pip_path: "{{ ansible_python_interpreter | dirname }}"

- name: "Uninstall lxml module from python"
  command: "{{ pip_path }}/pip uninstall lxml -y"
  become: true
  ignore_errors: true

- name: Remove all projects created for this workload
  k8s:
    state: absent
    api_version: project.openshift.io/v1
    kind: Project
    name: "{{ item }}"
  loop:
  - "{{ ocp4_workload_lpe_3scale_namespace }}"
  - "{{ ocp4_workload_lpe_3scale_minio_namespace }}"

- block:
  - name: Remove the Tenant Gateway Projects
    include_tasks: 
      file: ./files/3scale_remove_tenants.yml
  when: ocp4_workload_lpe_3scale_create_tenant|bool

- name: post_workload Tasks Complete
  debug:
    msg: "Post-Software checks completed successfully - Removed"
