# Name of 3scale API administrator of the tenant
- name: Set the tenant admin id
  set_fact:
    ocp4_workload_lpe_3scale_tenant_admin_id: "{{ ocp4_workload_lpe_3scale_tenant_admin_name_base }}"

- name: "Set the tenant org name {{ocp4_workload_lpe_3scale_tenant_user_name_base}}-tenant and openshift project {{ ocp4_workload_lpe_3scale_tenant_user_name_base }}-gw"
  set_fact:
    ocp4_workload_lpe_3scale_org_name: "{{ocp4_workload_lpe_3scale_tenant_user_name_base}}-tenant"
    ocp4_workload_lpe_3scale_tenant_gw_project: "{{ ocp4_workload_lpe_3scale_tenant_user_name_base }}-gw"


# Get the {{ ocp4_workload_lpe_3scale_org_name}} Tenant Secret
- name: Get the {{ ocp4_workload_lpe_3scale_org_name}} tenant secret
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Secret
    namespace: "{{ ocp4_workload_lpe_3scale_namespace }}"
    name: "{{ ocp4_workload_lpe_3scale_org_name }}-tenant-secret"
  register: r_dc
  until:
    - r_dc is defined
    - r_dc.resources is defined
    - r_dc.resources | list | length > 0
  retries: 60
  delay: 15

- name: Get the {{ ocp4_workload_lpe_3scale_org_name}} Admin Token
  set_fact:
    ocp4_workload_lpe_3scale_tenant_access_token: "{{ r_dc.resources[0].data.token | b64decode }}"

- name: Get the Tenant Portal Endpoint
  set_fact:
    ocp4_workload_lpe_3scale_tenant_portal_endpoint: "https://{{ ocp4_workload_lpe_3scale_tenant_access_token }}@{{ ocp4_workload_lpe_3scale_org_name }}-admin.{{ ocp4_workload_lpe_3scale_ocp_apps_domain }}"

- name: output tenant info
  agnosticd_user_info:
    msg: "{{ item }}"
  loop:
    - "user.info: "
    - "user.info: 3scale Tenant API Manager - details"
    - "user.info: "
    - "user.info: {{ ocp4_workload_lpe_3scale_org_name}} Admin Console : https://{{ ocp4_workload_lpe_3scale_org_name }}-admin.{{ ocp4_workload_lpe_3scale_ocp_apps_domain }}"
    - "user.info: Admin login with credentials {{ ocp4_workload_lpe_3scale_tenant_admin_id }} / {{ ocp4_workload_lpe_3scale_tenant_admin_password }} "
    - "user.info: "
    - "user.info: {{ ocp4_workload_lpe_3scale_org_name}} Admin Access URL : {{ ocp4_workload_lpe_3scale_tenant_portal_endpoint }}"
    - "user.info: "  
  when: not silent|bool

- name: Determine if tenant creation was required
  when: ocp4_workload_lpe_3scale_create_gws_with_each_tenant|bool
  block:
  - name: output gateway project info
    agnosticd_user_info:
      msg: "{{ item }}"
    loop:
      - "user.info: "
      - "user.info: Tenant's Gateway Project: {{ ocp4_workload_lpe_3scale_tenant_gw_project }} "
      - "user.info: "
      - "user.info: Tenant's OpenShift User: {{ ocp_username }}"
    when: not silent|bool