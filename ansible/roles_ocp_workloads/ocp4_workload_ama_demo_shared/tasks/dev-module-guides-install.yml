---

- name: search for guide {{ guide }}
  k8s_info:
    kind: DeploymentConfig
    name: guides-{{ guide }}
    namespace: dev-guides
  register: r_guide_dc

- name: Create a new app for the guides-{{ guide }}
  when: r_guide_dc.resources | list | length == 0
  shell: |
    oc new-app https://github.com/RedHat-Middleware-Workshops/mad-dev-guides-{{ guide }}.git --strategy=docker -n dev-guides

- name: Expose the deployment for the guides-{{ guide }}
  when: r_guide_dc.resources | list | length == 0
  shell: |
    oc expose deploy mad-dev-guides-{{ guide }} --port 3000 -n dev-guides

- name: Create an edge route for the guides-{{ guide }}
  when: r_guide_dc.resources | list | length == 0
  shell: |
    oc create route edge mad-dev-guides-{{ guide }} --service=mad-dev-guides-{{ guide }} -n dev-guides