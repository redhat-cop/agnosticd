---
- name: Setting up workload for user
  debug:
    msg: "Setting up workload for user ocp_username = {{ ocp_username }}"

# To Do: Implement your workload deployment tasks here
# -------------------------------------------------------------------------

- name: Create dbaas operator resources
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('file', item ) | from_yaml }}"
  loop:
    - dbaas_namespace.yaml
    - dbaas_catalogsource.yaml
    - dbaas_operatorgroup.yaml
    - dbaas_subscription.yaml

- name: Wait for at least one of the dbaas operator CRDs
  kubernetes.core.k8s_info:
    api_version: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
    name: dbaasinventories.dbaas.redhat.com
  until: 0 < r_crd.resources|length
  register: r_crd
  retries: 20
  delay: 5

# Leave this as the last task in the playbook.
# --------------------------------------------
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent|bool
