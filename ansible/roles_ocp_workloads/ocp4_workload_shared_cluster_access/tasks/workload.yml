---
- name: create user {{ ocp4_workload_shared_cluster_access_username }}
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'keycloak_user.yaml.j2') | from_yaml }}"

# - name: Add user {{ ocp_username}} to groups "{{ ocp4_workload_shared_cluster_access_user_groups }}"
#   when: ocp4_workload_shared_cluster_access_user_groups | default([]) | length > 0
#   command: "oc adm groups add-users {{ item }} {{ ocp_username }}"
#   register: r_groupadd_register
#   with_items: "{{ ocp4_workload_shared_cluster_access_user_groups }}"

# - name: Print Debug information
#   debug:
#     var: r_groupadd_register
#     verbosity: 2

- name: create ClusterResourceQuota
  when: ocp4_workload_shared_cluster_access_create_quota | bool
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'cluster_resource_quota.j2') | from_yaml }}"

# - name: Get console route
#   k8s_info:
#     api_version: route.openshift.io/v1
#     kind: Route
#     namespace: openshift-console
#     name: console
#   register: r_console_url

# - name: Get API server URL
#   k8s_info:
#     api_version: config.openshift.io/v1
#     kind: Infrastructure
#     name: cluster
#   register: r_api_url

# - name: save agnosticd user info
#   agnosticd_user_info:
#     data:
#       ocp4_workload_shared_cluster_access_api_url: "{{ r_api_url.resources[0].status.apiServerURL }}"
#       ocp4_workload_shared_cluster_access_console_url: https://{{ r_console_url.resources[0].spec.host }}
#       ocp4_workload_shared_cluster_access_username: "{{ ocp4_workload_shared_cluster_access_username }}"
