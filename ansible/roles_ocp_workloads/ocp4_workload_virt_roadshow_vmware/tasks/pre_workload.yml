---

# Implement your Pre Workload deployment tasks here
# -------------------------------------------------

# TODO: assume host is localhost
- name: Create private key for VMware jumphost
  ansible.builtin.copy:
    dest: /tmp/jumphostldap.pem
    content: "{{ vmware_ibm_ldap_jumphost_privatekey }}"
    mode: "0600"

- name: Add ldap jumphost host to the temporary inventory
  ansible.builtin.add_host:
    groupname: network
    name: jumphostldap
    bastion: ""
    isolated: true
    ansible_ssh_host: "{{ vmware_ibm_ldap_jumphost }}"
    ansible_ssh_user: "{{ vmware_ibm_ldap_jumphost_user }}"
    ansible_ssh_private_key_file: /tmp/jumphostldap.pem
    private_ip_address: "{{ vmware_ibm_ldap_jumphost }}"
    public_ip_address: "{{ vmware_ibm_ldap_jumphost }}"

- name: Get vSphere login session
  ansible.builtin.uri:
    validate_certs: false
    url: "https://{{ vcenter_hostname }}/rest/com/vmware/cis/session"
    method: POST
    headers:
      Content-Type: "application/json"
    body_format: json
    force_basic_auth: true
    url_username: "{{ vcenter_username }}"
    url_password: "{{ vcenter_password }}"
  register: r_login_response
