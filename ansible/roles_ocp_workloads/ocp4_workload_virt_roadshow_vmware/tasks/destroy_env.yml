---
# TODO: isn't this a repeat of the pre_workload.yml file?
# except for the two calls to add and remove access?

- name: Create private key for VMware jumphost
  ansible.builtin.copy:
    dest: /tmp/jumphostldap.pem
    content: "{{ vmware_ibm_ldap_jumphost_privatekey }}"
    mode: "0600"

- name: Add ldap jumphost host to the temporary inventory
  ansible.builtin.add_host:
    groupname: network
    name: jumphostldap
    bastion: ""
    isolated: true
    ansible_ssh_host: "{{ vmware_ibm_ldap_jumphost }}"
    ansible_ssh_user: "{{ vmware_ibm_ldap_jumphost_user }}"
    ansible_ssh_private_key_file: /tmp/jumphostldap.pem
    private_ip_address: "{{ vmware_ibm_ldap_jumphost }}"
    public_ip_address: "{{ vmware_ibm_ldap_jumphost }}"

- name: Remove access to vcenter
  ansible.builtin.include_tasks: vcenter-remove-access.yml

- name: Delete folder and VMs
  ansible.builtin.include_tasks: vcenter-remove-webapp-vms.yml

- name: Remove ldap jumphost from inventory
  hosts: localhost
  gather_facts: false
  become: false
  tasks:
  - meta: refresh_inventory
