---
- name: VDDK via internal OpenShift registry via BuildConfig
  when: ocp4_workload_virt_roadshow_vmware_vddk_registry.startswith('image-registry')
  block:

  - name: Set up VDDK Image
    kubernetes.core.k8s:
      state: present
      definition: "{{ lookup('file', resource | from_yaml) }}"
    loop:
    - vddk_imagestream.yaml
    - vddk_buildconfig.yaml
    loop_control:
      loop_var: resource

- name: VDDK via private registry from IBM icr.io
  when: ocp4_workload_virt_roadshow_vmware_vddk_registry.startswith('icr.io')
  block:

  - name: Create secret for accessing icr.io
    kubernetes.core.k8s:
      state: present
      definition: "{{ lookup('template', 'secret_icr.yml.j2' | from_yaml) }}"
