---
# Implement your workload removal tasks here
# ------------------------------------------

- name: Delete VMs on VMWare
  block:

  - name: Destroy webapp VMs in vcenter
    ansible.builtin.include_tasks: vcenter-remove-webapp-vms.yml

  - name: Create private key for VMware jumphost
    ansible.builtin.copy:
      dest: /tmp/jumphostldap.pem
      content: "{{ vmware_ibm_ldap_jumphost_privatekey }}"
      mode: "0600"

  - name: Add ldap jumphost host to the temporary inventory
    ansible.builtin.add_host:
      groupname: network
      name: jumphostldap
      bastion: ""
      isolated: true
      ansible_ssh_host: "{{ vmware_ibm_ldap_jumphost }}"
      ansible_ssh_user: "{{ vmware_ibm_ldap_jumphost_user }}"
      ansible_ssh_private_key_file: /tmp/jumphostldap.pem
      private_ip_address: "{{ vmware_ibm_ldap_jumphost }}"
      public_ip_address: "{{ vmware_ibm_ldap_jumphost }}"

  - name: Remove access to vcenter
    ansible.builtin.include_tasks: vcenter-remove-access.yml

- name: Remove ldap jumphost from inventory
  ansible.builtin.meta: refresh_inventory

# Leave this as the last task in the playbook.
# --------------------------------------------

- name: remove_workload tasks complete
  debug:
    msg: "Remove Workload tasks completed successfully."
  when: not silent|bool
