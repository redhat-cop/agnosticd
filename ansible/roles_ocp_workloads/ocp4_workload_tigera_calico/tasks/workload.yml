---
# apply operatorgroup yaml
- name: "Create OperatorGroup"
  k8s:
    state: present
    definition: "{{ lookup('template', 'operatorgroup.yml.j2') }}"

# apply subscription yaml
- name: "Create Subscription"
  k8s:
    state: present
    definition: "{{ lookup('template', 'subscription.yml.j2') }}"

# download client configuration
- name: "Download yaml for client configuration"
  get_url:
    url: "{{ calico_client_manifest_url }}"
    dest: "/home/{{ ansible_user }}/{{ guid }}_calico_client_manifest.yaml"
    mode: 0644

# apply client configuration
- name: "Create client configuration"
  k8s:
    state: present
    src: "/home/{{ ansible_user }}/{{ guid }}_calico_client_manifest.yaml"

- name: workload Tasks Complete
  debug:
    msg: workload Tasks Complete
