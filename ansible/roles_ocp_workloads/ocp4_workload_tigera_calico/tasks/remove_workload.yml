---
# delete subscription yaml
- name: "Delete Subscription"
  k8s:
    state: absent
    definition: "{{ lookup('template', 'subscription.yml.j2') }}"

# delete operatorgroup yaml
- name: "Delete OperatorGroup"
  k8s:
    state: absent
    definition: "{{ lookup('template', 'operatorgroup.yml.j2') }}"

# delete namespace
- name: "Deleting namespace"
  k8s:
    name: "{{ target_namespace }}"
    api_version: v1
    kind: Namespace
    state: absent

# download client configuration
- name: "Download yaml for client configuration"
  get_url:
    url: "{{ calico_client_manifest_url }}"
    dest: "/home/{{ ansible_user }}/{{ guid }}_calico_client_manifest.yaml"
    mode: 0644

# delete client configuration
- name: "Deleting client configuration"
  k8s:
    state: absent
    src: "/home/{{ ansible_user }}/{{ guid }}_calico_client_manifest.yaml"

# delete client configuration
- name: "Delete yaml for client configuration"
  file:
    path: "/home/{{ ansible_user }}/{{ guid }}_calico_client_manifest.yaml"
    state: absent
