kind: List
metadata:
  resourceVersion: ""
  selfLink: ""
apiVersion: v1
items:
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: app-workspace-pvc
    namespace: "{{ ocp4_workload_aiml_namespace }}"
  spec:
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 1Gi
    storageClassName: gp2
    volumeMode: Filesystem
- apiVersion: triggers.tekton.dev/v1alpha1
  kind: EventListener
  metadata:
    name: el-object-detection-app-git
    namespace: "{{ ocp4_workload_aiml_namespace }}"
  spec:
    triggers:
    - name: object-detection-app-git-trigger
      bindings:
        ref: "object-detection-app-git-template"
- apiVersion: triggers.tekton.dev/v1alpha1
  kind: TriggerBinding
  metadata:
    name: "object-detection-app-git-binding"
    namespace: "{{ ocp4_workload_aiml_namespace }}"
  spec:
    params:
    - name: git-repo-url
      value: \$(body.repository.clone_url)
    - name: git-revision
      value: \$(body.after)
- apiVersion: triggers.tekton.dev/v1alpha1
  kind: TriggerTemplate
  metadata:
    name: "object-detection-app-git-template"
    namespace: "{{ ocp4_workload_aiml_namespace }}"
  spec:
    resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
      kind: PipelineRun
      metadata:
        generateName: object-detection-app-git-ci-pipeline-
        nnamespace: "{{ ocp4_workload_aiml_namespace }}"
        labels:
          tekton.dev/pipeline: object-detection-app-git-ci-pipeline
      spec:
        params:
          - name: IMAGE
            value: image-registry.openshift-image-registry.svc:5000/cicd/object-detection-app-git
          - name: GIT_REPO_URL
            value: "{{ _ocp4_workload_object_detection_ai_ml_ohc_gitea_app_repo_url }}"
          - name: GIT_MICROSERVICES_REPO_URL
            value: "{{ _ocp4_workload_object_detection_ai_ml_ohc_gitea_source_repo_url }}"
          - name: GIT_REPO_REVISION
            value: main
          - name: STACKROX_IMAGE
            value:  "defaut/cicd/object-detection-app-git"
          - name: SONARQUBE_HOST_URL
            value:  "temp"
        pipelineRef:
          name: object-detection-app-git-ci-pipeline
        serviceAccountName: pipeline
        timeout: 1h0m0s
        workspaces:
          - name: app-workspace
            persistentVolumeClaim:
              claimName: app-workspace-pvc
- kind: Route
  apiVersion: route.openshift.io/v1
  metadata:
    name: el-el-object-detection-app-git
    namespace: {{ ocp4_workload_aiml_namespace }}
  spec:
    to:
      kind: Service
      name: el-object-detection-app-git
      weight: 100
    port:
      targetPort: http-listener
    wildcardPolicy: None
