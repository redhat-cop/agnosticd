---
- name: Get kubeadmin password
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Secret
    name: "{{ _ocp4_workload_rhacm_hypershift_cluster_name }}-kubeadmin-password"
    namespace: local-cluster
  register: r_kubeadmin_password

- name: Get kubeconfig
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Secret
    name: "{{ _ocp4_workload_rhacm_hypershift_cluster_name }}-admin-kubeconfig"
    namespace: local-cluster
  register: r_kubeconfig

- name: "Save credentials for cluster {{ _ocp4_workload_rhacm_hypershift_cluster_name }}"
  agnosticd_user_info:
    data: >-
      {{ {
        _ocp4_workload_rhacm_hypershift_cluster_name ~ '-kubeadmin-password': r_kubeadmin_password.resources[0].data.password | b64decode,
        _ocp4_workload_rhacm_hypershift_cluster_name ~ '-admin-kubeconfig': r_kubeconfig.resources[0].data.kubeconfig | b64decode
      } }}
