---

- name: get OpenShift Console URL
  kubernetes.core.k8s_info:
    api_version: config.openshift.io/v1
    kind: Console
    name: cluster
  register: r_console
  failed_when: >-
    r_console.resources is not defined or
    r_console.resources | length == 0 or
    r_console.resources[0].status is not defined or
    r_console.resources[0].status.consoleURL is not defined

- name: get IngressController
  kubernetes.core.k8s_info:
    kind: IngressController
    name: default
    namespace: openshift-ingress-operator
  register: r_ingress
  failed_when: >-
    r_ingress.resources is not defined or
    r_ingress.resources | length == 0 or
    r_ingress.resources[0].status is not defined or
    r_ingress.resources[0].status.domain is not defined

- name: save agnosticd user info
  when: ocp4_workload_getting_started_user_count | int > 1
  vars:
    _ocp4_workload_getting_started_user: "{{ ocp4_workload_getting_started_user_prefix }}{{ n }}"
  agnosticd_user_info:
    user: "{{ _ocp4_workload_getting_started_user }}"
    data:
      ocp4_starter_console_url: "{{ r_console.resources[0].status.consoleURL }}"
      ocp4_starter_apps_domain: "{{ r_ingress.resources[0].status.domain }}"
      ocp4_starter_project: "{{ _ocp4_workload_getting_started_user }}-{{ ocp4_workload_getting_started_user_project }}"
      ocp4_starter_username: "{{ _ocp4_workload_getting_started_user }}"
      ocp4_starter_password: "{{ ocp4_workload_getting_started_user_password }}"
  loop: "{{ range(1, ocp4_workload_getting_started_user_count | int + 1) | list }}"
  loop_control:
    loop_var: n
    label: "{{ ocp4_workload_getting_started_user_prefix }}{{ n }}"
