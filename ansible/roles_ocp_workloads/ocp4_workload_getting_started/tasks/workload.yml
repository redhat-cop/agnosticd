---

- name: get OpenShift Console URL
  kubernetes.core.k8s_info:
    api_version: config.openshift.io/v1
    kind: Console
    name: cluster
  register: r_console

- name: get IngressController
  kubernetes.core.k8s_info:
    kind: IngressController
    name: default
    namespace: openshift-ingress-operator
  register: r_ingress_controller

- name: save agnosticd user info
  when: ocp4_workload_getting_started_user_count | int > 1
  vars:
    _ocp4_workload_getting_started_user: "{{ ocp4_workload_getting_started_user_prefix }}{{ n }}"
  agnosticd_user_info:
    user: "{{ _ocp4_workload_getting_started_user }}"
    data:
      ocp4_starter_console_url: "{{ r_console.resources[0].status.consoleURL }}"
      ocp4_starter_apps_domain: "{{ r_ingress_controller.resources[0].status.domain }}"
      ocp4_starter_project: "{{ _ocp4_workload_getting_started_user }}-{{ ocp4_workload_getting_started_user_project }}"
      ocp4_starter_username: "{{ _ocp4_workload_getting_started_user }}"
      ocp4_starter_password: "{{ lookup('agnosticd_user_data', 'password', user=_ocp4_workload_getting_started_user) }}"
  loop: "{{ range(1, ocp4_workload_getting_started_user_count | int + 1) | list }}"
  loop_control:
    loop_var: n
    label: "{{ ocp4_workload_getting_started_user_prefix }}{{ n }}"
