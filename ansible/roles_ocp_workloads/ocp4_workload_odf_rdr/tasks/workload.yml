---
# Implement your Workload deployment tasks here
- name: Setting up workload for user
  debug:
    msg: "Setting up workload for user ocp_username = {{ ocp_username }}"

- environment:
    KUBECONFIG: "{{ tmp_kubeconfig }}"
  block:
    # - name: Wait until ODF is ready
    #   k8s_info:
    #     api_version: ocs.openshift.io/v1
    #     kind: StorageCluster
    #     name: ocs-storagecluster
    #     namespace: openshift-storage
    #   register: r_storagecluster
    #   until:
    #    - r_storagecluster.resources.0.status.phase == "Ready"
    #   retries: 5
    #   delay: 5
    #
    # - name: Wait until NooBaa is ready
    #   k8s_info:
    #     api_version: noobaa.io/v1alpha1
    #     kind: NooBaa
    #     name: noobaa
    #     namespace: openshift-storage
    #   register: r_noobaa
    #   until:
    #    - r_noobaa.resources.0.status.phase == "Ready"
    #   retries: 5
    #   delay: 5

    - name: ODF Multicluster Orchestrator Operator
      k8s:
        state: present
        definition: "{{ lookup('template','./templates/subscription-odf-multi-orch.yaml.j2') | from_yaml }}"


# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent | bool
