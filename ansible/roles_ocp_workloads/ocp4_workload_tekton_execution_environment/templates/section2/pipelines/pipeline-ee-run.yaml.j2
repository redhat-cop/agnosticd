apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  name: {{ _name_ }}-piplerun-{{ item.type }}-{{ 999999999999999999999 | random | to_uuid }}
  namespace: {{ ocp4_workload_tekton_ee_namespace }}
  labels:
    tekton.dev/pipeline: pipeline-ansible-builder
spec:
  params:
    - name: GIT_URL
      value: {{ item.git_params.url }}/{{ item.git_params.repository }}
    - name: GIT_REVISION
      value: {{ item.git_params.branch |default('main')}}
    - name: INT_REGISTRY
      value: {{ ocp4_workload_tekton_ee_internal_registry_route }}
    - name: EXT_REGISTRY
      value: {{ ocp4_workload_tekton_ee_hub_registry_route }}
    - name: IMAGE_NAME
      value: {{ item.ee_params.name }}
  pipelineRef:
    name: {{ _name_ }}-pipeline-ee-builder
  serviceAccountName: pipeline
  timeout: 1h0m0s
  workspaces:
    - name: ee-repo
      persistentVolumeClaim:
        claimName: {{ _name_ }}-pvc-image-builder
