---
- name: Set Ansible Python interpreter to k8s virtualenv
  set_fact:
    ansible_python_interpreter: /opt/virtualenvs/k8s/bin/python

- name: Create patient-portal-frontend-deploy app on aws cluster
  environment:
    KUBECONFIG: "{{ tmp_kubeconfig }}"
  block:
    - name: deploy aws application
      kubernetes.core.k8s:
        state: present
        definition: "{{ lookup('template', item ) | from_yaml }}"
      loop:
        - "aws/namespace.yaml.j2"
        - "aws/deployment.yaml.j2"
        - "aws/service.yaml.j2"
        - "aws/route.yaml.j2"
