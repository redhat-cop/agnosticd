---
- name: Set Ansible Python interpreter to k8s virtualenv
  set_fact:
    ansible_python_interpreter: /opt/virtualenvs/k8s/bin/python

- name: Create patient-portal-payment-processor.yaml.j2 app on azure cluster
  environment:
    KUBECONFIG: "{{ tmp_kubeconfig }}"
  block:
    - name: deploy azure application
      kubernetes.core.k8s:
        state: present
        definition: "{{ lookup('template', item ) | from_yaml }}"
      loop:
        - "azure/namespace.yaml.j2"
        - "azure/deployment.yaml.j2"
