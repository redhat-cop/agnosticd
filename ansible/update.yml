---
# Entry point for update action.

- name: Setup AgnosticD Runtime
  import_playbook: setup_runtime.yml

- name: Start environment
  import_playbook: >-
    {{ lookup('first_found', {
         'files': [ 'start.yml', 'lifecycle.yml' ],
         'paths': ['configs/' + env_type, playbook_dir]
       })
    }}
  vars:
    ACTION: start

- name: Process Lifecycle Post Start Hook
  vars:
    __find_lifecycle_hook_params:
      files:
        - configs/{{ env_type }}/lifecycle_hook_post_start.yml
        - configs/{{ env_type }}/lifecycle_hook.yml
        - lifecycle_hook.yml
  import_playbook: >-
    {{ lookup('first_found', __find_lifecycle_hook_params) }}

- name: Update deployment
  vars:
    __find_update_params:
      files:
        - configs/{{ env_type }}/update.yml
        - update_placeholder.yml
  import_playbook: >-
    {{ lookup('first_found', __find_update_params) }}

- import_playbook: save_output_dir.yml

- import_playbook: completion_callback.yml
