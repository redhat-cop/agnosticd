---
- import_playbook: ../include_vars.yml

- name: Clean up subscription manager
  hosts: all,!localhost
  become: true
  gather_facts: false
  roles:
    - role: set-repositories
      when: repo_method is defined

- name: Delete Infrastructure
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tasks:
    - name: Run infra-azure-template-destroy
      include_role:
        name: infra-azure-template-destroy
    - name: Remove the service principal
      include_role:
        name: infra-azure-delete-service-principal
