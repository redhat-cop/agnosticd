---
# - name: destroy resources
#   command: >
#     ibmcloud schematics destroy --id {{ workspace_id }} --output json --force
#   register: r_destroy_resources

# - name: destroy workspace
#   command: >
    # ibmcloud schematics workspaces delete --id {{ workspace_id }} --output json --force

- name: Listing ssh-key
  command: >
    ibmcloud is keys --json
  register: r_ssh_keys_new

- debug:
    var: r_ssh_keys_new.stdout | from_json

- name: Set the key_pair_id 
  set_fact:
    key_pair_id: (r_ssh_keys_new.stdout | from_json) | json_query(key_pair_id_query)
  vars:
    key_pair_id_query: >
      [?name=='{{ guid }}-key'].id|[0]

# I don't know why this is not working, if you can take a look it would be appreaciated
# - name: Delete key pair
#   command: >
#     ibmcloud is key-delete {{ key_pair_id }} --force