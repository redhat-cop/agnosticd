---
- name: Get Access Group ID
  uri:
    url: "https://iam.cloud.ibm.com/v2/groups?account_id={{ sandbox_account_id }}"
    headers:
      Authorization: Bearer {{ auth_token }}
  register: r_sandbox_access_groups

- name: Set access group ID
  set_fact: 
    sandbox_access_group: "{{ r_sandbox_access_groups['json']['groups'] | json_query(ag_query) }}"
  vars:
    ag_query: "[?name=='sandbox_ag'].id | [0]"

- name: Add SID to access group
  uri:
    url: "https://iam.cloud.ibm.com/v2/groups/{{ sandbox_access_group }}/members"
    method: PUT
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 207
    body_format: json
    body:
      members:
        - iam_id: "{{ sandbox_sid_id }}"
          type: "service"
  register: r_sid_access_group