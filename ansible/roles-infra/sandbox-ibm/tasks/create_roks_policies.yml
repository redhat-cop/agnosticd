---
- name: Create cloud object storage policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Administrator"
          display_name: "Administrator"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "cloud-object-storage"

- name: Create container registry policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Administrator"
          display_name: "Administrator"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "container-registry"

- name: Create containers-kubernetes policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Administrator"
          display_name: "Administrator"
        - role_id: "crn:v1:bluemix:public:iam::::serviceRole:Writer"
          display_name: "Writer"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "containers-kubernetes"

- name: Create is policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Administrator"
          display_name: "Administrator"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "is"

- name: Create iam-identity policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam-identity::::serviceRole:ServiceIdCreator"
          display_name: "Service ID creator"
        - role_id: "crn:v1:bluemix:public:iam-identity::::serviceRole:UserApiKeyCreator"
          display_name: "User API key creator"
        - role_id: "crn:v1:bluemix:public:iam::::role:Editor"
          display_name: "Editor"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "iam-identity"

- name: Create cloudcerts policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Editor"
          display_name: "Editor"
        - role_id: "crn:v1:bluemix:public:iam::::serviceRole:Manager"
          display_name: "Manager"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "cloudcerts"

- name: Create global catalog policy
  uri:
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Viewer"
          display_name: "Viewer"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "globalcatalog"

- name: Create kms policy
    url: "https://iam.cloud.ibm.com/v1/policies"
    method: POST
    headers:
      Authorization: Bearer {{ auth_token }}
    status_code: 201
    body_format: json
    body:
      type: "access"
      subjects:
        - attributes:
          - name: "access_group_id"
            value: "{{ sandbox_roks_access_group }}"
      roles:
        - role_id: "crn:v1:bluemix:public:iam::::role:Administrator"
          display_name: "Administrator"
        - role_id: "crn:v1:bluemix:public:iam::::serviceRole:Manager"
          display_name: "Manager"
        - role_id: "crn:v1:bluemix:public:kms::::serviceRole:KeyPurge"
          display_name: "KeyPurge"
      resources:
        - attributes:
          - name: "accountId"
            operator: "stringEquals"
            value: "{{ sandbox_account_id }}"
          - name: "serviceName"
            operator: "stringEquals"
            value: "kms"
