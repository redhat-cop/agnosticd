---
- name: Get a list of VMs
  k8s_info:
    kind: VirtualMachine
    namespace: "{{ openshift_cnv_project_name }}"
  register: r_vm_list


- name: Start the Virtual Machines
  loop: "{{ r_vm_list.resources }}"
  loop_control:
    loop_var: _instance
  kubevirt.core.kubevirt_vm:
    host: "{{ openshift_cnv_api_uri }}"
    api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"
    validate_certs: False
    running: true
    name: "{{ _instance.metadata.name }}"
    namespace: "{{ openshift_cnv_project_name }}"
