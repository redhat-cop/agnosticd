---
- name: Create OpenShift CNV project
  k8s:
    api_version: v1
    kind: Namespace
    state: present
    name: "{{ openshift_cnv_project_name }}"
  register: r_project


- name: Allow clone PVC from cnv-images namespace to the project namespace
  k8s:
    definition:
      apiVersion: rbac.authorization.k8s.io/v1
      kind: RoleBinding
      metadata:
        name: "allow-clone-{{ openshift_cnv_project_name }}"
        namespace: cnv-images
      subjects:
      - kind: ServiceAccount
        name: default
        namespace: "{{ openshift_cnv_project_name }}"
      roleRef:
        kind: ClusterRole
        name: datavolume-cloner
        apiGroup: rbac.authorization.k8s.io


  register: r_project

- name: Save Project in user_info
  agnosticd_user_info:
    data:
      openshift_cnv_project_name: "{{ openshift_cnv_project_name }}"
