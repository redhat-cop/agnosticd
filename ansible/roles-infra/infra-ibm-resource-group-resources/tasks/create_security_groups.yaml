- name: Create Security Group
  register: ibmcloud_security_group_create
  ibm.cloudcollection.ibm_is_security_group:
    name: "sg-{{ guid }}"
    resource_group: "{{ r_ibmcloud_resource_group_id }}"
    vpc: "{{ ibmcloud_vpc_create.resource.id }}"
    region: "{{ ibmcloud_region }}"

- name: Add Securty Group Rules
  register: ibmcloud_security_group_rule_create
  ibm.cloudcollection.ibm_is_security_group_rule:
    group: "{{ ibmcloud_security_group_create.resource.id }}"
    region: "{{ ibmcloud_region }}"
    direction: inbound
    remote: 0.0.0.0/0
    tcp:
      - port_max: 22
        port_min: 22

- name: Add Securty Group Rules
  register: ibmcloud_security_group_rule_create_outbound
  ibm.cloudcollection.ibm_is_security_group_rule:
    group: "{{ ibmcloud_security_group_create.resource.id }}"
    region: "{{ ibmcloud_region }}"
    direction: outbound
    remote: 0.0.0.0/0
