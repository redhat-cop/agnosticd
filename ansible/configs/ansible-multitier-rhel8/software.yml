---
- name: Step 00xxxxx software
  hosts: localhost
  gather_facts: False
  become: false
  tasks:
    - debug:
        msg: "Software tasks Started"

###
### RHEL8-Workshop stuff
###
- name: setup passwd ssh, copy and run RHEL8-Workshop playbooks on "workstation" to set up vms
  hosts: bastion
  become: yes
  tasks:

  - name: Enable password ssh #1
    lineinfile:
      path: /etc/ssh/sshd_config
      regexp: '^PasswordAuthentication no'
      line: "#PasswordAuthentication no"

  - name: Enable password ssh #2
    lineinfile:
      path: /etc/ssh/sshd_config
      regexp: '^#PasswordAuthentication yes'
      line: "PasswordAuthentication yes"

  - name: Restart sshd
    service:
      name: sshd
      state: restarted


  - name: git clone the RHEL8-Workshop on the "workstation" node and run
    git:
      repo: 'https://github.com/xtophd/RHEL8-Workshop/'
      dest: /root/RHEL8-Workshop
      version: Summit2020


  - name: Change the working directory to RHEL8-Workshop, then run the prep/install script
    shell: |
      cp sample-configs/rhel8-workshop config/rhel8-workshop
      /bin/bash prepare-rhel8-workshop.sh > prepare-rhel8-workshop.log 2>&1
      let status=$?
      echo "status=$status" >> prepare-rhel8-workshop.log
      echo 'done'
    args:
      chdir: /root/RHEL8-Workshop

- name: Software flight-check
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tags:
    - post_flight_check
  tasks:
    - debug:
        msg: "Software checks completed successfully"
