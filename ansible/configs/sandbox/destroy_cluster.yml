---
- debug:
    msg: "Deleting {{ cluster_dir }} using user {{ username }}"

- name: pack an archive of everything
  archive:
    path: "{{ cluster_dir }}"
    dest: /tmp/{{ guid }}_{{ cluster_dir | basename }}.tar.gz
  become: true
  become_user: "{{ username }}"

- name: get archive of environment target dir
  fetch:
    flat: true
    src: /tmp/{{ guid }}_{{ cluster_dir | basename }}.tar.gz
    dest: "{{ hostvars.localhost.output_dir }}/{{ env_type }}_{{ guid }}_{{ guid }}_{{ cluster_dir | basename }}.tar.gz"
  become: true
  become_user: "{{ username }}"
