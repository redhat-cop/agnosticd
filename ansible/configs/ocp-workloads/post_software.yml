---
- name: Deploy workload(s) role on bastion of the shared cluster
  hosts: ocp_bastions
  become: false
  gather_facts: false
  tags:
    - step005
  tasks:
  - name: Set Ansible Python interpreter to k8s virtualenv
    set_fact:
      ansible_python_interpreter: /opt/virtualenvs/k8s/bin/python

  - name: Run a single workload
    when: ocp_workload is defined
    include_role:
      name: "{{ ocp_workload }}"
    vars:
      ACTION: create

  - name: Run a list of workloads
    when:
    - ocp_workloads is defined
    - ocp_workloads | length > 0
    include_role:
      name: "{{ _ocp_workload }}"
    vars:
      ACTION: create
    loop: "{{ ocp_workloads }}"
    loop_control:
      loop_var: _ocp_workload

- import_playbook: cleanup.yml
