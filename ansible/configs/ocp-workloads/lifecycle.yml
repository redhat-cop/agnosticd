---
- name: Setup runtime
  ansible.builtin.import_playbook: ../../setup_runtime.yml

- name: Build inventory
  ansible.builtin.import_playbook: post_infra.yml

- name: Destroy workload(s)
  hosts: ocp_bastions
  become: false
  gather_facts: false
  tags:
    - step005
  tasks:
  - name: Fail if no action defined
    when: ACTION is not defined or ACTION == ''
    ansible.builtin.fail:
      msg: ACTION must be defined

  - name: Run workload
    when: ocp_workload is defined
    ansible.builtin.include_role:
      name: "{{ ocp_workload }}"

  - name: Run workloads
    when:
    - ocp_workloads is defined
    - ocp_workloads | length > 0
    loop: "{{ ocp_workloads }}"
    loop_control:
      loop_var: _ocp_workload
    ansible.builtin.include_role:
      name: "{{ _ocp_workload }}"

- name: Cleanup
  ansible.builtin.import_playbook: cleanup.yml
