- name: Retrieve route subdomains
      ansible.builtin.set_fact:
        aws_route_subdomain: "{{ aws_a_provision_data.openshift_console_url | replace('https://console-openshift-console.','') }}"
        azure_route_subdomain: "{{ azure_a_provision_data.openshift_console_url | replace('https://console-openshift-console.','') }}"
        azure_console_url: "{{ azure_a_provision_data.openshift_console_url }}"
        rhel_hostname: "{{ rhel_a_provision_data.hostname }}"

- name: Retrieve additional services
      ansible.builtin.set_fact:
        solution_explorer_services: '{{ lookup("template", "instructions-services.json.j2") }}'
        
- name: Patch Instructions with Additional Hostnames
      kubernetes.core.k8s_json_patch:
        api_version: "integreatly.org/v1alpha1"
        kind: WebApp
        namespace: solution-explorer
        name: tutorial-web-app
        patch:
          - op: replace
            path: /spec/template/parameters/INSTALLED_SERVICES
            value: "{{ solution_explorer_services }}"
        api_key: "{{ __r_aws_cluster.k8s_auth.api_key }}"
        host: "{{ aws_a_provision_data.openshift_api_url }}"
        validate_certs: false
