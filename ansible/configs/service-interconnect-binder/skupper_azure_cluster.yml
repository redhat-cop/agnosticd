- name: Set common vars for skupper
  set_fact:
    platform: kubernetes
    namespace: azure

- name: Skopper install
  become: true
  block:
      - include_role:
          name: skupper.network.skupper_cli_install
        vars:
          skupper_cli:
            force: "True"

- name: Initialize skupper
  include_role:
    name: skupper.network.skupper_init
    
- name: Generate token secret-azure-vm-token
  include_role:
    name: skupper.network.skupper_token
  vars:
    token:
      name: secret-azure-vm-token
      type: claim

- name: Get token secret-azure-vm-token
  set_fact:
    secret_azure_vm_token: "{{ generatedToken }}"

- name: Copy secret_aws_azure_token
  ansible.builtin.copy:
    content: "{{ hostvars[groups['aws_bastion'][0]].secret_aws_azure_token }}"
    dest: secret-aws-azure.token
