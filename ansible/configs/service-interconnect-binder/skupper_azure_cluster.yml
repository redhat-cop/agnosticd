---
- name: Executing skupper init
  ansible.builtin.command:
    argv:
      - skupper
      - init
      - --platform
      - kubernetes
      - --namespace
      - azure
  register: initStatus

- name: Create link to aws
  ansible.builtin.command:
    argv:
      - skupper
      - link
      - create
      - secret_aws_azure.token
      - --name
      - aws-to-azure
      - --platform
      - kubernetes
      - --namespace
      - azure
  register: initStatus

- name: Generate token command
  ansible.builtin.command:
    argv: 
      - skupper
      - token
      - create
      - --platform
      - kubernetes
      - --namespace
      - azure
      - secret_azure_vm.token

- name: Read secret_azure_vm.token
  ansible.builtin.slurp:
    src: secret_azure_vm.token
  register: _r_secret_azure_vm_token

- name: Print token secret_azure_vm.token
  debug:
    msg: "{{ _r_secret_azure_vm_token.content | b64decode }}"
