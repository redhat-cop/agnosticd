#!/bin/bash
# Deploy Cluster
export VERSION={{ my_ocp_version }}
export OPENSHIFT_RELEASE_IMAGE="registry.svc.ci.openshift.org/ocp/release:$VERSION"
{% if my_ocp_offline %}
export LOCAL_REG='provision.{{ my_ocp_domain }}:5000'
export LOCAL_REPO='ocp4/openshift4'
export OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE=${LOCAL_REG}/${LOCAL_REPO}:${VERSION}
{% endif %}
mkdir `pwd`/ocp
cp `pwd`/install-config.yaml `pwd`/ocp
case $VERSION in
  4.3*) `pwd`/openshift-baremetal-install --dir=ocp create manifests
        cp `pwd`/metal3-config.yaml `pwd`/ocp/openshift/99_metal3-config.yaml
        ;;
     *) ;;
esac
`pwd`/openshift-baremetal-install --dir=ocp --log-level debug create cluster
