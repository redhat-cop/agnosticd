---
- name: Step 00xxxxx software
  hosts: localhost
  gather_facts: false
  become: false
  environment: &aws_environment
    AWS_ACCESS_KEY_ID: "{{ aws_access_key_id }}"
    AWS_SECRET_ACCESS_KEY: "{{ aws_secret_access_key }}"
    AWS_REGION: "{{ ec2_region }}"
  tasks:
    - debug:
        msg: "Software tasks Started"

- name: include workshop_type unique setup roles
  environment: *aws_environment
  import_playbook: "workshops/{{workshop_type}}.yml"

- name: setup demos
  hosts: control_nodes
  gather_facts: false
  vars:
    my_tower_username: admin
    my_tower_password: "{{ admin_password }}"
    my_tower_host: "{{ ansible_host }}"
  environment: *aws_environment
  tasks:
    - name: install demos from ansible.product_demos collection
      block:
        - name: install demo
          include_role:
            name: "ansible.product_demos.install_demo"
          when:
            - demo is defined
            - towerinstall is defined
            - towerinstall
      rescue:
        - name: install demo
          debug:
            msg: "Demos were NOT installed"

        - name: update demo_information var
          set_fact:
            demo_information: "Demo issue: Demos were NOT installed"
