---
- name: Step 00xxxxx post software
  hosts: localhost
  gather_facts: false
  become: true
  environment: &aws_environment
    AWS_ACCESS_KEY_ID: "{{ aws_access_key_id }}"
    AWS_SECRET_ACCESS_KEY: "{{ aws_secret_access_key }}"
    AWS_REGION: "{{ ec2_region }}"
  tasks:
    - debug:
        msg: "Post-Software tasks Started"

- name: Alert the mothership
  hosts: localhost
  connection: local
  become: false
  environment: *aws_environment
  gather_facts: false
  tasks:
    - {include_role: {name: ansible.workshops.tower_request}, when: student_total > 9}

- name: print out information for instructor
  hosts: localhost
  connection: local
  gather_facts: false
  environment: *aws_environment
  tasks:
    - name: set facts for output
      set_fact:
        summary_information: |
          PROVISIONER SUMMARY
          *******************
          - Workshop name is {{ec2_name_prefix}}
          - Instructor inventory is located at  {{playbook_dir}}/{{ec2_name_prefix}}/instructor_inventory.txt
          - Private key is located at {{playbook_dir}}/{{ec2_name_prefix}}/{{ec2_name_prefix}}-private.pem
          {% if attendance %}
          - {{hostvars['attendance-host'].login_website_information | default("attendance feature is off") }}
          {% endif %}

          FAILURES
          *******************
          {{dns_information}}
          {{callback_information}}
          {{ demo_information }}

    - name: Print Summary Information
      debug:
        msg: "{{summary_information}}"
