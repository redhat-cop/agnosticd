---

- name: Step 002 Post Infrastructure
  hosts: localhost
  connection: local
  become: false
  gather_facts: false
  tags:
    - step002
    - post_infrastructure

  tasks:

    - name: "Step 002 Post Infrastructure"
      ansible.builtin.debug:
        msg: "Step 000 Post Infrastructure"

- name: Step 002 Post Infrastructure regreSSHion Hotfix
  hosts: all:!windows:!network
  become: true
  gather_facts: false
  tags:
    - regresshion_hotfix

  tasks:

    - name: Set sshd LoginGraceTime to 0 in /etc/ssh/sshd_config
      ansible.builtin.lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '.*LoginGraceTime.*'
        line: 'LoginGraceTime 0'

    - name: Restart SSH service for regreSSHion fix
      ansible.builtin.service:
        name: sshd
        state: restarted
