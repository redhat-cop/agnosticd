---
- name: Delete VMs on RHV
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tasks:
  - name: Install collection ovirt.ovirt
    shell: ansible-galaxy collection install ovirt.ovirt==1.4.2

  - name: Destroy webrhv VM
    environment:
      OVIRT_URL: "https://{{ ocp4_workload_ama_demo_rhev_host }}/ovirt-engine/api"
      OVIRT_USERNAME: "opentlc-mgr@internal"
      OVIRT_PASSWORD: "{{ ocp4_workload_ama_demo_rhev_admin_user_password }}"
    ovirt.ovirt.ovirt_vm:
      auth:
        url: "https://{{ ocp4_workload_ama_demo_rhev_host }}/ovirt-engine/api"
        username: "opentlc-mgr@internal"
        password: "{{ ocp4_workload_ama_demo_rhev_admin_user_password }}"
        insecure: true
      state: absent
      name: "webrhv-{{ guid }}"
      cluster: "Default"
      storage_domain: "vmstore00"

- name: Import default destroy playbook
  import_playbook: ../../cloud_providers/{{cloud_provider}}_destroy_env.yml
