---
- name: Step 005 Post Software
  hosts: bastions
  become: false
  gather_facts: false
  tasks:
  - name: Post-software steps message
    ansible.builtin.debug:
      msg: "Post-Software Steps starting"

- name: Step 005.1 Deploy workloads
  when:
  - rosa_deploy | default(true) | bool
  - infra_workloads | default("") | length > 0
  ansible.builtin.import_playbook: workloads.yml

- name: Step 005.2 Lab Documentation (Showroom)
  hosts: bastions
  become: true
  gather_facts: false
  tasks:
  # Workaround to deploy Showroom on bastion VM until podified version
  # is available via workload
  - name: Deploy Showroom
    when: showroom_deploy | default(false) | bool
    block:
    - name: Set Ansible Python interpreter to system python
      set_fact:
        ansible_python_interpreter: /usr/libexec/platform-python

    - name: Deploy Showroom
      when: showroom_deploy | default(false) | bool
      vars:
        common_password: "{{ rosa_user_password }}"
        ssh_command: ssh "{{ bastion_user_name }}@bastion.{{ subdomain_base }}"
        ssh_password: "{{ rosa_user_password }}"
        ssh_username: "{{ bastion_user_name }}"
        targethost: "bastion.{{ subdomain_base }}"
      ansible.builtin.include_role:
        name: showroom

- name: Step 005.3 Lab Documentation (Bookbag)
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tasks:
  - name: Deploy Bookbag
    when: deploy_bookbag | default(false) | bool
    vars:
      ACTION: create
    ansible.builtin.include_role:
      name: bookbag

- name: PostSoftware flight-check
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tags:
  - post_flight_check
  tasks:
  - name: Print Post-Software flight check message
    ansible.builtin.debug:
      msg: "Post-Software checks completed successfully"
