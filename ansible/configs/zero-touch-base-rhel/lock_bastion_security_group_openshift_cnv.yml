---
- name: Configure NetworkPolicy
  register: r_network_policy
  kubernetes.core.k8s:
    host: "{{ sandbox_openshift_api_url }}"
    api_key: "{{ k8s_auth_results.k8s_auth.api_key|default(sandbox_openshift_api_key) }}"
    validate_certs: false
    definition: | 
      apiVersion: networking.k8s.io/v1
      kind: NetworkPolicy
      metadata:
        name: zero-touch-policy2
      spec:
        podSelector: {}
        policyTypes:
          - Ingress
          - Egress
        ingress:
          - ports:
            {% for port in zero_touch_ports|default([443]) -%}
            - port: {{ port }}
              protocol: TCP
            {% endfor -%}
            from:
              - ipBlock:
                  cidr: "0.0.0.0/0"
        egress: {{ egress_dns_rule + zero_touch_egress_rules | default([]) }}
