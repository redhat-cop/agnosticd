---
- name: Configure NetworkPolicy
  kubernetes.core.k8s:
    host: "{{ sandbox_openshift_api_url }}"
    api_key: "{{ k8s_auth_results.k8s_auth.api_key|default(sandbox_openshift_api_key) }}"
    validate_certs: false
    definition:
      apiVersion: networking.k8s.io/v1
      kind: NetworkPolicy
      metadata:
        name: "lock-bastion-{{guid}}"
        namespace: "{{ openshift_cnv_namespace }}"
      spec:
        podSelector: {}
        policyTypes:
          - Ingress
          - Egress
        ingress: "{{ network_policy_ingress | default(default_ingress_rules) }}"
        egress: "{{ network_policy_egress | default(default_egress_rules) }}"
