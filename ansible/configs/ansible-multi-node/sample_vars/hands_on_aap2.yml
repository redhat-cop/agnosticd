---
#  Ansible Automation Platform 2 Foundations vars

env_type: ansible-multi-node
cloud_provider: osp                         # Cloud Provider to use

# This config depreciates software_to_deploy in favor of direct call to role deploy_ansiblecontroller

agnosticd_inventory_exporter_enable: true   # Test the new export inventory
software_to_deploy: none 

automationcontroller_install: false

install_vscode_server: false                       # Use container version?

inventory_groups:
  - load_balancers
  - app_servers
  - database_servers

common_packages:
  - at
  - bash-completion
  - bind-utils
  - git
  - python
  - python-pip
  - unzip
  - tmux
  - tree
  - vim-enhanced
  - wget

default_flavor: 2c2g30d       # Default instance types 
control_flavor: 4c4g30d 
automationcontroller_flavor: 4c8g30d 
webserver_flavor:           "{{ default_flavor }}"

default_image:              rhel-8.4      # Default operating system image

# Environment Instances

instances:

  - name: control
    count: 1
    unique: true
    public_dns: true
    dns_loadbalancer: true
    floating_ip: true
    image_id: "{{ control_system_image | default(default_image) }}"
    flavor:
      osp: "{{ control_flavor | default(default_flavor) }}"
    security_groups:
      - BastionSG
      - WebSG
      - HostSG
    tags:
      - key: "AnsibleGroup"
        value: "bastions"
      - key: "ostype"
        value: "linux"
      - key: "instance_filter"
        value: "{{ env_type }}-{{ email }}"

  - name: ac
    count: 1
    # unique: true
    public_dns: false
    floating_ip: true
    image_id: "{{ automationcontroller_image | default(default_image) }}"
    flavor:
      osp: "{{ automationcontroller_flavor | default(default_flavor) }}"
    security_groups:
      - BastionSG
      - WebSG
      - HostSG
    tags:
      - key: "AnsibleGroup"
        value: "automationcontroller"
      - key: "ostype"
        value: "linux"
      - key: "instance_filter"
        value: "{{ env_type }}-{{ email }}"

  - name: frontend
    count: "{{ frontend_count | default(1) }}"
    floating_ip: true
    public_dns: false
    image_id: "{{ frontend_image | default(default_image) }}"
    flavor:
      osp: "{{ frontend_flavor | default(default_flavor) }}"
    tags:
      - key: "AnsibleGroup"
        value: "load_balancers"
      - key: "ostype"
        value: "rhel"
      - key: "instance_filter"
        value: "{{ env_type }}-{{ email }}"
    key_name: "{{key_name}}"
    security_groups:
      - DefaultSG
      - WebSG
      - HostSG

  - name: app-0
    count: "{{ app_servers_count | default(2) }}"
    floating_ip: false
    public_dns: false
    image_id: "{{ app_servers_image | default(default_image) }}"
    flavor:
      osp: "{{ app_servers_flavor | default(default_flavor) }}"
    tags:
      - key: "AnsibleGroup"
        value: "app_servers"
      - key: "ostype"
        value: "rhel"
      - key: "instance_filter"
        value: "{{ env_type }}-{{ email }}"
    key_name: "{{key_name}}"
    security_groups:
      - DefaultSG
      - WebSG
      - HostSG

  - name: database-01
    count: "{{ database_servers_count | default(1) }}"
    floating_ip: false
    public_dns: false
    image_id: "{{ database_servers_image | default(default_image) }}"
    flavor:
      osp: "{{ database_servers_flavor | default(default_flavor) }}"
    tags:
      - key: "AnsibleGroup"
        value: "database_servers"
      - key: "ostype"
        value: "rhel"
      - key: "instance_filter"
        value: "{{ env_type }}-{{ email }}"
    key_name: "{{key_name}}"
    security_groups:
      - DefaultSG
      - WebSG
      - HostSG

...
