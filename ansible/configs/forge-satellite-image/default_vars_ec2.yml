---
### AWS EC2 Environment settings

ansible_user: ec2-user
remote_user: ec2-user
aws_region: us-east-2

### Networking and DNS (AWS)

subdomain_base_short: "{{ guid }}"

subdomain_base: "{{ subdomain_base_short }}{{ subdomain_base_suffix }}"
zone_internal_dns: "{{ guid }}.internal."
chomped_zone_internal_dns: "{{ guid }}.internal"

cf_template_description: "{{ env_type }}-{{ guid }} Ansible Agnostic Deployer "

satellite_instance_image: RHEL8GOLD-latest
satellite_instance_image: r7a.2xlarge

#
# Vars for Satellite volume tuning & performance
#

aws_default_volume_type: gp3
aws_ebs_volume_iops: 6000
aws_ebs_volume_throughput: 600

#
# Instances to deploy
#

instances:

  - name: "satellite"
    count: 1
    unique: true
    public_dns: true
    dns_loadbalancer: true
    floating_ip: true
    image:
      name: "{{ satellite_instance_image | default('RHEL8GOLD-latest') }}"
    flavor:
      ec2: "{{ satellite_instance_type | default('r7a.2xlarge') }}"
    tags:
    - key: "AnsibleGroup"
      value: "bastions,satellites"
    - key: "ostype"
      value: "linux"
    - key: "instance_filter"
      value: "{{ env_type }}-{{ email }}"
    rootfs_size: 250
    security_groups:
    - WebSG
    - DefaultSG
    - NodeSG
    - SatSG

security_groups:

  - name: WebSG
    rules:
      - name: HTTPPorts
        description: "HTTP Public"
        from_port: 80
        to_port: 80
        protocol: tcp
        cidr: "0.0.0.0/0"
        rule_type: Ingress

      - name: HTTPSPorts
        description: "HTTP Public"
        from_port: 443
        to_port: 443
        protocol: tcp
        cidr: "0.0.0.0/0"
        rule_type: Ingress

  - name: ShowroomSG
    rules:
      - name: ShowroomHTTPS
        description: "Primary showroom endpoint - for reverse proxy"
        from_port: 8443
        to_port: 8443
        protocol: tcp
        cidr: "0.0.0.0/0"
        rule_type: Ingress

      - name: ShowroomExposed
        description: "Showroom views or exposed services, up to 26 of them"
        from_port: 8500
        to_port: 8525
        protocol: tcp
        cidr: "0.0.0.0/0"
        rule_type: Ingress

  - name: HostSG
    rules:
      - name: FromHostSG
        description: "Allow everything from HostSG nodes"
        from_port: 0
        to_port: 65535
        protocol: -1
        from_group: HostSG
        rule_type: Ingress

  - name: SatSG
    rules:
    - name: FromSatSCAP
      description: "Open OpenSCAP"
      from_port: 9090
      to_port: 9090
      protocol: tcp
      cidr: "0.0.0.0/0"
      rule_type: Ingress

    - name: FromSatKA
      description: "Open Katello Agent"
      from_port: 5647
      to_port: 5647
      protocol: tcp
      cidr: "0.0.0.0/0"
      rule_type: Ingress

    - name: FromSatMQTT
      description: "Open remote-execution MQTT"
      from_port: 883
      to_port: 883
      protocol: tcp
      cidr: "0.0.0.0/0"
      rule_type: Ingress

...
