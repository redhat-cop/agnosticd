---
- name: downloading manifest from OpenTLC
  get_url:
    url: "{{ satellite_manifest_url }}"
    dest: "/tmp/{{ satellite_manifest_url | regex_search('(\\w+)(\\.\\w+)+(?!.*(\\w+)(\\.\\w+)+)') }}"
    username: "{{ satellite_manifest.username | d(omit) }}"
    password: "{{ satellite_manifest.password | d(omit) }}"

- name: inject Ansible Tower license manifest
  awx.awx.tower_license:
    manifest: "/tmp/{{ satellite_manifest_url | regex_search('(\\w+)(\\.\\w+)+(?!.*(\\w+)(\\.\\w+)+)') }}"
    eula_accepted: true
    tower_config_file: "~/.tower_cli.cfg"

- name: remove manifest file
  file:
    path: "/tmp/{{ satellite_manifest_url | regex_search('(\\w+)(\\.\\w+)+(?!.*(\\w+)(\\.\\w+)+)') }}"
    state: absent
    