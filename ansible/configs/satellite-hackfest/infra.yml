- name: Step 001.3 Configure Linux Hosts and Wait for Connection
  hosts:
    # For now, only bastion is necessary
    - bastions:!windows:!network
  gather_facts: false
  any_errors_fatal: true
  ignore_errors: false
  tags:
    - step001
    - step001.3
    - wait_ssh
  tasks:
    - name: set facts for remote access
      tags:
        - create_inventory
      set_fact:
        # set python interpreter: Useful when the distrib running ansible has a different path
        # ex: when running using the alpine image
        #ansible_python_interpreter: env python
        ansible_ssh_common_args: >-
          {{ ansible_ssh_extra_args|d() }}
          -F {{ output_dir }}/{{ env_type }}_{{ guid }}_ssh_conf
          -o ControlPath=/tmp/{{ guid }}-%r-%h-%p

    - name: Run infra-generic-wait_for_linux_hosts Role
      import_role:
        name: infra-generic-wait_for_linux_hosts
