---
- name: Step 003 Pre Software
  hosts: localhost
  connection: local
  become: false
  gather_facts: false
  tags:
    - step003
    - pre_software

  tasks:

    - name: Placeholder debug output
      debug:
        msg: 
          - Pre Software playbook pre-software.yml being called
          - tags: step0003, pre_software

- name: Configure common options on managed nodes and control nodes
  hosts: "control:web"
  gather_facts: false
  become: true
  vars:
    username: "{{ workshop_student_username | default('student') }}"

  tasks:

    - name: Setup Workshop user account
      include_role:
        name: ansible.workshops.user_accounts

    - name: Run common workshop role
      include_role:
        name: ansible.workshops.common
      vars:
        short_name: "{{ hostvars[ansible_host].shortname }}"


- name: configure ansible control node
  hosts: control
  gather_facts: true
  become: true
  vars:
    controllerinstall: false
    tower_node_aws_api_access: false
  tasks:

    - name: Setup Ansible Workshop control node
      include_role:
        name: ansible.workshops.control_node

    - include_role:
        name: ansible.workshops.code_server
      when:
        - code_server is defined
        - code_server
        - controllerinstall is defined
        - controllerinstall

- name: PreSoftware flight-check
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tags:
    - flight_check

  tasks:

    - name: Output end of Pre-Software debug
      debug:
        msg: "Pre-Software checks completed successfully"
