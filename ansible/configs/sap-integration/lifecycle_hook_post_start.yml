---
# Post Start actions for OCP 4 Cluster configs
- name: Run recover cluster actions
  hosts: bastions
  run_once: true
  become: false
  gather_facts: false
  tasks:
  - name: Set Ansible Python interpreter to k8s virtualenv
    set_fact:
      ansible_python_interpreter: /opt/virtualenvs/k8s/bin/python

  - name: Perform actions on start
    when: ACTION == 'start'
    block:
    - name: Approve CertificateSigningRequests
      include_role:
        name: ocp4_approve_certificate_signing_requests

    - name: Cleanup failed pods
      include_role:
        name: ocp_cleanup_failed_pods
