---
- name: Step 004 Environment specific Software
  hosts: localhost
  gather_facts: false
  become: false
  tasks:
    - debug:
        msg: "Software tasks Started"

- name: Deploy OCP if IPI is defined
  hosts: bastion
  tasks:
    - name: deploy OCP
      include_role:
        name: ocp4_aio_deploy_ocp
      vars:
        deploy_type: "{{ ocp4_aio_deploy_type }}"
        deploy_sno: "{{ ocp4_aio_deploy_sno }}"
        deploy_ipi: "{{ ocp4_aio_deploy_ipi }}"
        deploy_ocs: "{{ ocp4_aio_deploy_ocs }}"
        deploy_compact: "{{ ocp4_aio_deploy_compact }}"
        ocp_version: "{{ ocp4_aio_ocp_version }}"
        aio_host_ip_address: "{{ hostvars['hypervisor']['public_ip_address'] }}"
      when: ocp4_aio_deploy_type == 'ipi'

- name: Deploy SNO clusters if SNO is defined
  hosts: hypervisor
  tasks:
    - name: deploy SNO
      include_role:
        name: ocp4_aio_deploy_ocp
      vars:
        deploy_type: "{{ ocp4_aio_deploy_type }}"
        deploy_sno: "{{ ocp4_aio_deploy_sno }}"
        deploy_ipi: "{{ ocp4_aio_deploy_ipi }}"
        deploy_ocs: "{{ ocp4_aio_deploy_ocs }}"
        ocp_version: "{{ ocp4_aio_ocp_version }}"
      when: ocp4_aio_deploy_type == 'sno'

- name: Software flight-check
  hosts: localhost
  connection: local
  gather_facts: false
  become: false
  tags:
    - post_flight_check
  tasks:
    - debug:
        msg: "Software checks completed successfully"
