---
- name: Step 00xxxxx post software
  hosts: bastions
  become: true
  gather_facts: false

  tasks:
  - debug:
      msg: "Post-Software Steps starting"

- name: Step 005.6 Print Student Info
  hosts: localhost
  gather_facts: false
  become: false
  tasks:
  - name: Print Access Information
    when:
    - install_student_user | bool
    - ocp4_cluster_show_access_user_info | bool
    block:
    - name: Store bastion hostname as a fact
      set_fact:
        bastion_hostname: "{{groups['bastions'].0 }}"
    - name: Print access user info
      agnosticd_user_info:
        msg: "{{ item }}"
      loop:
      - "You can access your bastion via SSH:"
      - "ssh {{ student_name }}@{{ hostvars[bastion_hostname].shortname }}.{{ guid }}{{ subdomain_base_suffix if cloud_provider == 'ec2' else '.'+ocp4_base_domain }}"
      - ""
      - "Make sure you use the username '{{ student_name }}' and the password '{{ hostvars[bastion_hostname]['student_password'] }}' when prompted."
    - name: Print kubeadmin user info
      agnosticd_user_info:
        msg: "kubeadmin password {{ hostvars[bastion_hostname]['kubeadmin_password']['content'] | b64decode }}"
      when: cloud_provider == "azure" or cloud_provider == "gcp"

- name: Step 005.7 Tell CloudForms we are done
  hosts: localhost
  run_once: true
  gather_facts: false
  become: false
  tasks:
  - debug:
      msg: "Post-Software checks completed successfully"
